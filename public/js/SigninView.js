import{B as S,E as A,d as B,g as r,x as F,C as N,k as L,o as v,j as h,e as i,b as o,c as P,u as c,f as u,t as T,n as D,i as x,a as n,w as I,D as M,r as U}from"../index.js";import{_ as G,a as j,P as K}from"./PlainLayout.js";import{I as O}from"./InputGroup.js";import{I as $,A as z}from"./AlertSuccess.js";import{u as q}from"./authComposable.js";import{s as W}from"./toast.js";import{_ as H}from"./SpinnerLoading.vue_vue_type_script_setup_true_lang.js";import"./logo-ppdb.js";import"./login-ilustrasi.js";import"./HeroIcon.vue_vue_type_script_setup_true_lang.js";import"./_plugin-vue_export-helper.js";const J=async()=>{var p;try{await S.get(A.CSRF,{withCredentials:!0})}catch(l){throw S.isAxiosError(l)?new Error(((p=l.response)==null?void 0:p.data.message)||"Failed to get CSRF token"):new Error("An unexpected error occurred")}},Q={class:"mb-5 mt-6"},X=["disabled"],Y={class:"flex items-center"},Z={class:"mt-6 text-center"},ee={class:"font-medium"},ce=B({__name:"SigninView",setup(p){const l=r(""),f=r(""),m=r(!1),s=r(!1),d=r(""),{login:C}=q(),V=M(),E=F(),g=N(),R=async()=>{try{await J()}catch(t){console.error(t),W({message:"Gagal mengambil CSRF token, silakan muat ulang halaman login ini",type:"warning",duration:5e3,autoClose:!0})}},b=async()=>{var t,e;m.value=!0,s.value=!1;try{await C(l.value,f.value)}catch(a){((t=a==null?void 0:a.response)==null?void 0:t.status)===401||((e=a==null?void 0:a.response)==null?void 0:e.status)===422?(s.value=!0,d.value="Username atau password salah"):(a==null?void 0:a.code)==="ERR_NETWORK"?(s.value=!0,d.value="Koneksi internet bermasalah"):(s.value=!0,d.value="Sepertinya jaringan anda atau server kami mengalami masalah, coba lagi beberapa saat")}finally{m.value=!1}};return L(async()=>{const t=V.query.intended||"/dashboard";E.intendedURL=t,await R()}),(t,e)=>{const a=U("router-link");return v(),h(K,null,{default:i(()=>[o(j,{subtitle:"PPDB Online Kuantan Singingi v1",title:"Login"},{default:i(()=>{var _,k,w;return[s.value?(v(),P("div",{key:0,class:D(["mb-2 mt-4 transform transition-all duration-500 ease-out",{"opacity-0 translate-y-5":!s.value,"opacity-100 translate-y-0":s.value}])},[o(c($),{icon:"",type:"danger"},{default:i(()=>[u(T(d.value),1)]),_:1})],2)):x("",!0),(_=c(g).messages)!=null&&_.success?(v(),h(z,{key:1,class:"mb-5",message:(k=c(g).messages)==null?void 0:k.success.title,detail:(w=c(g).messages)==null?void 0:w.success.detail},null,8,["message","detail"])):x("",!0),n("form",{onSubmit:I(b,["prevent"])},[o(O,{name:"username",label:"Email / Username",type:"email",placeholder:"Enter your email",modelValue:l.value,"onUpdate:modelValue":e[0]||(e[0]=y=>l.value=y)},null,8,["modelValue"]),o(G,{label:"Password anda",modelValue:f.value,"onUpdate:modelValue":e[1]||(e[1]=y=>f.value=y)},null,8,["modelValue"]),n("div",Q,[n("button",{type:"submit",class:"w-full flex justify-center items-center cursor-pointer rounded-lg border border-primary bg-primary p-2 font-medium text-white transition hover:bg-opacity-90",onClick:b,disabled:m.value},[n("span",Y,[o(H,{loading:m.value,size:"xs"},null,8,["loading"]),e[2]||(e[2]=n("span",{class:"ml-2"},"Login",-1))])],8,X)]),n("div",Z,[n("p",ee,[e[5]||(e[5]=u(" Belum Mempunyai Akun? ")),o(a,{to:"/daftar",class:"text-primary"},{default:i(()=>e[3]||(e[3]=[u("Daftar")])),_:1}),e[6]||(e[6]=u(" atau ")),o(a,{to:"sekolah/daftar",class:"text-primary"},{default:i(()=>e[4]||(e[4]=[u("daftarkan sekolah anda")])),_:1})])])],32)]}),_:1})]),_:1})}}});export{ce as default};
