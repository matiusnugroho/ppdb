import{z as _,E as V,f as E,g as r,u as R,A,i as B,o as v,k,w as i,d as o,c as F,j as c,e as u,t as N,n as L,q as w,a as n,p as P,B as T,r as I}from"../index.js";import{_ as M,a as U,P as D}from"./PlainLayout.js";import{I as G}from"./InputGroup.js";import{I as j,A as z}from"./AlertSuccess.js";import{u as K}from"./authComposable.js";import{s as O}from"./toast.js";import{_ as $}from"./SpinnerLoading.vue_vue_type_script_setup_true_lang.js";import"./login-ilustrasi.js";import"./HeroIcon.vue_vue_type_script_setup_true_lang.js";import"./_plugin-vue_export-helper.js";const q=async()=>{var p;try{await _.get(V.CSRF,{withCredentials:!0})}catch(l){throw _.isAxiosError(l)?new Error(((p=l.response)==null?void 0:p.data.message)||"Failed to get CSRF token"):new Error("An unexpected error occurred")}},W={class:"mb-5 mt-6"},H=["disabled"],J={class:"flex items-center"},Q={class:"mt-6 text-center"},X={class:"font-medium"},ie=E({__name:"SigninView",setup(p){const l=r(""),f=r(""),m=r(!1),s=r(!1),d=r(""),{login:S}=K(),h=T(),x=R(),g=A(),C=async()=>{try{await q()}catch(t){console.error(t),O({message:"Gagal mengambil CSRF token, silakan muat ulang halaman login ini",type:"warning",duration:5e3,autoClose:!0})}},b=async()=>{var t,e;m.value=!0,s.value=!1;try{await S(l.value,f.value)}catch(a){((t=a==null?void 0:a.response)==null?void 0:t.status)===401||((e=a==null?void 0:a.response)==null?void 0:e.status)===422?(s.value=!0,d.value="Username atau password salah"):(a==null?void 0:a.code)==="ERR_NETWORK"?(s.value=!0,d.value="Koneksi internet bermasalah"):(s.value=!0,d.value="Sepertinya jaringan anda atau server kami mengalami masalah, coba lagi beberapa saat")}finally{m.value=!1}};return B(async()=>{const t=h.query.intended||"/dashboard";x.intendedURL=t,await C()}),(t,e)=>{const a=I("router-link");return v(),k(D,null,{default:i(()=>[o(U,{subtitle:"PPDB Online Kuantan Singingi v1",title:"Login"},{default:i(()=>[s.value?(v(),F("div",{key:0,class:L(["mb-2 mt-4 transform transition-all duration-500 ease-out",{"opacity-0 translate-y-5":!s.value,"opacity-100 translate-y-0":s.value}])},[o(c(j),{icon:"",type:"danger"},{default:i(()=>[u(N(d.value),1)]),_:1})],2)):w("",!0),c(g).messages.success?(v(),k(z,{key:1,class:"mb-5",message:c(g).messages.success.title,detail:c(g).messages.success.detail},null,8,["message","detail"])):w("",!0),n("form",{onSubmit:P(b,["prevent"])},[o(G,{name:"username",label:"Email / Username",type:"email",placeholder:"Enter your email",modelValue:l.value,"onUpdate:modelValue":e[0]||(e[0]=y=>l.value=y)},null,8,["modelValue"]),o(M,{label:"Password anda",modelValue:f.value,"onUpdate:modelValue":e[1]||(e[1]=y=>f.value=y)},null,8,["modelValue"]),n("div",W,[n("button",{type:"submit",class:"w-full flex justify-center items-center cursor-pointer rounded-lg border border-primary bg-primary p-2 font-medium text-white transition hover:bg-opacity-90",onClick:b,disabled:m.value},[n("span",J,[o($,{loading:m.value,size:"xs"},null,8,["loading"]),e[2]||(e[2]=n("span",{class:"ml-2"},"Login",-1))])],8,H)]),n("div",Q,[n("p",X,[e[5]||(e[5]=u(" Belum Mempunyai Akun? ")),o(a,{to:"/daftar",class:"text-primary"},{default:i(()=>e[3]||(e[3]=[u("Daftar")])),_:1}),e[6]||(e[6]=u(" atau ")),o(a,{to:"sekolah/daftar",class:"text-primary"},{default:i(()=>e[4]||(e[4]=[u("daftarkan sekolah anda")])),_:1})])])],32)]),_:1})]),_:1})}}});export{ie as default};
