import{_ as oe}from"./BreadcrumbDefault.vue_vue_type_script_setup_true_lang.js";import{g as b,u as W,h as N,E as j,f as K,x as B,i as J,o as V,c as H,a as e,j as a,p as U,d as l,n as $,e as O,q as C,y as te,t as re,k as se,w as le}from"../index.js";import{s as w}from"./toast.js";import{u as q}from"./formValidationErrors.js";import{C as ne}from"./component.js";import{_ as z}from"./HeroIcon.vue_vue_type_script_setup_true_lang.js";import{f as d}from"./fieldErrorHtml.js";import{_ as G}from"./SpinnerLoading.vue_vue_type_script_setup_true_lang.js";import{h as _}from"./hasError.js";import{I as h}from"./InputGroup.js";import{_ as ie}from"./DefaultLayout.vue_vue_type_script_setup_true_lang.js";import"./_plugin-vue_export-helper.js";import"./authComposable.js";function de(){const y=b(0),s=b(!1),f=b(!1),n=b(null),t=b(!1),M=j.UPDATE_PHOTO_SISWA,k=j.ME_SISWA,u=W(),T=q();return{uploadPhoto:async P=>{var m,c;y.value=0,n.value=null,t.value=!1;const x=new FormData;x.append("foto",P);try{s.value=!0;const p=await N.post(M,x,{onUploadProgress:v=>{v.total&&(y.value=Math.round(v.loaded*100/v.total))}});if(p.data.success){const v=p.data.data;return u.biodata&&(u.biodata.thumbnail_url=v.thumbnail_url,u.biodata.foto_url=v.foto_url),t.value=!0,!0}else return T.errors=p.data.errors,!1}catch(p){return n.value=((c=(m=p.response)==null?void 0:m.data)==null?void 0:c.message)||"An error occurred during upload.",T.errors=p.response.data.errors,!1}finally{s.value=!1}},loadingUpdatePhoto:s,uploadProgress:y,uploadError:n,uploadSuccess:t,updateProfile:async P=>{var x,m;n.value=null,f.value=!0;try{const c=await N.patch(k,P);if(c.data.success){const p=c.data.data;return u.biodata&&(u.biodata=p.biodata,u.user=p.user),!0}else return T.errors=c.data.errors,!1}catch(c){return console.error("Update profile error:",c.response),T.errors=((m=(x=c.response)==null?void 0:x.data)==null?void 0:m.errors)||{},!1}finally{f.value=!1}},loadingUpdateProfile:f}}function ue(){return{smoothScrollToTop:(s,f)=>{try{const n=document.querySelector(s);if(n){const t={top:0,behavior:"smooth",...f};n.scrollTo(t)}else console.warn(`Element with selector ${s} not found.`)}catch(n){console.error("Error in smoothScrollToTop:",n)}}}}const me={class:"grid grid-cols-5 gap-8"},ce={class:"col-span-5 xl:col-span-3"},pe={class:"rounded-sm border border-stroke bg-white shadow-default dark:border-strokedark dark:bg-boxdark"},be={key:0,class:"p-7"},fe={class:"mb-3"},_e=["innerHTML"],he={class:"mb-3"},ge=["innerHTML"],ve={class:"mb-3"},ke=["innerHTML"],xe={class:"mb-3"},ye=["innerHTML"],Te={class:"mb-3"},we=["innerHTML"],Ve={class:"mb-3"},Me=["innerHTML"],Pe={class:"grid grid-cols-1 md:grid-cols-5 gap-6 mb-3"},Le={class:"md:col-span-3 flex flex-col"},Se=["innerHTML"],He={class:"md:col-span-2 flex flex-col"},Ue={class:"relative flex-grow"},Ee={class:"absolute right-3 top-1/2 transform -translate-y-1/2 cursor-pointer text-primary"},Ce=["innerHTML"],Fe={class:"mb-3"},Ne=["innerHTML"],je={class:"mb-3"},qe=["innerHTML"],De={class:"mb-3"},Ie=["innerHTML"],Ae={class:"flex justify-end gap-4.5"},Be=["disabled"],$e={class:"flex items-center gap-2"},Oe={key:0,class:"col-span-5 xl:col-span-2"},ze={class:"rounded-sm border border-stroke bg-white shadow-default dark:border-strokedark dark:bg-boxdark"},Ge={class:"p-7"},We={class:"flex flex-col items-center justify-center space-y-3"},Ke={class:"text-primary flex h-10 w-10 items-center justify-center rounded-full bg-white dark:bg-meta-4"},Je=["innerHTML"],Re={key:0,class:"relative mt-4 flex items-center justify-center mb-3"},Ye=["src"],Qe={key:0,class:"absolute inset-0 flex items-center justify-center bg-black bg-opacity-50 rounded"},Xe={class:"flex justify-end gap-4.5"},Ze=["disabled"],ea={class:"flex items-center gap-2"},aa=K({__name:"FormBiodata",setup(y){const s=W(),{smoothScrollToTop:f}=ue(),n=q();let t=B({user:s.user?{...s.user}:null,biodata:s.biodata?{...s.biodata}:null});const M=b(""),k=b(null),u=b(!1),{uploadPhoto:T,loadingUpdatePhoto:E,uploadProgress:F,updateProfile:P,uploadError:x,loadingUpdateProfile:m}=de(),c=async()=>{var S,A;n.clearErrors();const{foto:i,...o}=t.biodata,r={...o,username:(S=t.user)==null?void 0:S.username,email:(A=t.user)==null?void 0:A.email};m.value=!0,await P(r).catch(ae=>{w({message:"Profile update failed "+ae.message,type:"error"})}).finally(()=>{m.value=!1})?w({message:"Profile updated"}):w({message:"Profile update failed",type:"error"}),f("#sangkonten")},p=()=>{t.user=s.user?{...s.user}:null,t.biodata=s.biodata?{...s.biodata}:null},v=()=>{p()},D=async()=>{await T(k.value)?w({message:"Foto berhasil diperbarui"}):w({message:"Gagal update foto, "+x.value,type:"error"}),u.value=!1,k.value=null,f("#sangkonten")},R=i=>{var g;const o=i.target,r=(g=o.files)==null?void 0:g[0];r?I(r):M.value="kosong",o.value=""},Y=()=>{k.value=null,u.value=!1,t.biodata.thumbnail_url=s.biodata.thumbnail_url},Q=b({allowInput:!0,format:"d-m-Y"}),L=b(!1),X=()=>{L.value=!0},Z=()=>{L.value=!1},ee=i=>{var r,g;L.value=!1;const o=(g=(r=i.dataTransfer)==null?void 0:r.files)==null?void 0:g[0];o&&I(o)},I=i=>{if(!i.type.startsWith("image/")){w({message:"File harus berupa gambar",type:"error"});return}const o=new FileReader;o.onload=r=>{var g,S;M.value=(g=r.target)==null?void 0:g.result,t.biodata.thumbnail_url=(S=r.target)==null?void 0:S.result},o.readAsDataURL(i),k.value=i,u.value=!0};return J(async()=>{s.biodata||await N.get(j.ME_SISWA).then(i=>{const o=i.data.data;s.biodata=o.biodata,s.user=o.user,t=B({user:s.user?{...s.user}:null,biodata:s.biodata?{...s.biodata}:null})})}),(i,o)=>(V(),H("div",me,[e("div",ce,[e("div",pe,[o[13]||(o[13]=e("div",{class:"border-b border-stroke py-4 px-7 dark:border-strokedark"},[e("h3",{class:"font-medium text-black dark:text-white"},"Personal Information")],-1)),a(t).biodata?(V(),H("div",be,[e("form",{onSubmit:U(c,["prevent"])},[e("div",fe,[l(h,{label:"Nomor Induk Siswa Nasional",modelValue:a(t).biodata.nisn,"onUpdate:modelValue":o[0]||(o[0]=r=>a(t).biodata.nisn=r),error:a(_)("nisn"),name:"nisn",inputmode:"numeric",required:""},null,8,["modelValue","error"]),e("div",{innerHTML:a(d)("nisn")},null,8,_e)]),e("div",he,[l(h,{label:"Nomor Induk Kependudukan",modelValue:a(t).biodata.nik,"onUpdate:modelValue":o[1]||(o[1]=r=>a(t).biodata.nik=r),error:a(_)("nik"),name:"nik",inputmode:"numeric",required:""},null,8,["modelValue","error"]),e("div",{innerHTML:a(d)("nik")},null,8,ge)]),e("div",ve,[l(h,{label:"Nomor Kartu Keluarga",modelValue:a(t).biodata.no_kk,"onUpdate:modelValue":o[2]||(o[2]=r=>a(t).biodata.no_kk=r),error:a(_)("no_kk"),name:"no_kk",inputmode:"numeric",required:""},null,8,["modelValue","error"]),e("div",{innerHTML:a(d)("no_kk")},null,8,ke)]),e("div",xe,[l(h,{label:"Nama",modelValue:a(t).biodata.nama,"onUpdate:modelValue":o[3]||(o[3]=r=>a(t).biodata.nama=r),error:a(_)("nama"),name:"nama",inputmode:"text",required:""},null,8,["modelValue","error"]),e("div",{innerHTML:a(d)("nama")},null,8,ye)]),e("div",Te,[l(h,{label:"Email",modelValue:a(t).user.email,"onUpdate:modelValue":o[4]||(o[4]=r=>a(t).user.email=r),error:a(_)("email"),name:"email",type:"email",inputmode:"email",required:""},null,8,["modelValue","error"]),e("div",{innerHTML:a(d)("email")},null,8,we)]),e("div",Ve,[l(h,{label:"Username",modelValue:a(t).user.username,"onUpdate:modelValue":o[5]||(o[5]=r=>a(t).user.username=r),error:a(_)("username"),name:"username",inputmode:"text",required:""},null,8,["modelValue","error"]),e("div",{innerHTML:a(d)("username")},null,8,Me)]),e("div",Pe,[e("div",Le,[l(h,{class:"h-full",label:"Tempat Lahir",modelValue:a(t).biodata.tempat_lahir,"onUpdate:modelValue":o[6]||(o[6]=r=>a(t).biodata.tempat_lahir=r),error:a(_)("tempat_lahir"),name:"tempat_lahir",inputmode:"text",required:""},null,8,["modelValue","error"]),e("div",{innerHTML:a(d)("tempat_lahir")},null,8,Se)]),e("div",He,[o[11]||(o[11]=e("label",{class:"mb-1 block text-black dark:text-white",for:"tanggal-lahir"}," Tanggal Lahir ",-1)),e("div",Ue,[l(a(ne),{modelValue:a(t).biodata.tanggal_lahir,"onUpdate:modelValue":o[7]||(o[7]=r=>a(t).biodata.tanggal_lahir=r),class:"w-full rounded border border-stroke bg-gray py-1 px-2.5 font-normal text-black focus:border-primary focus-visible:outline-none dark:border-strokedark dark:bg-meta-4 dark:text-white dark:focus:border-primary h-full",config:Q.value,id:"tanggal-lahir"},null,8,["modelValue","config"]),e("span",Ee,[l(z,{name:"calendar-search",class:"w-5 h-5"})])]),e("div",{innerHTML:a(d)("tanggal_lahir")},null,8,Ce)])]),e("div",Fe,[l(h,{label:"Nama Ayah",modelValue:a(t).biodata.nama_bapak,"onUpdate:modelValue":o[8]||(o[8]=r=>a(t).biodata.nama_bapak=r),error:a(_)("nama_bapak"),name:"nama_bapak",inputmode:"text",required:""},null,8,["modelValue","error"]),e("div",{innerHTML:a(d)("nama_bapak")},null,8,Ne)]),e("div",je,[l(h,{label:"Nama Ibu",modelValue:a(t).biodata.nama_ibu,"onUpdate:modelValue":o[9]||(o[9]=r=>a(t).biodata.nama_ibu=r),error:a(_)("nama_ibu"),name:"nama_ibu",inputmode:"text",required:""},null,8,["modelValue","error"]),e("div",{innerHTML:a(d)("nama_ibu")},null,8,qe)]),e("div",De,[l(h,{label:"No. HP Orang Tua",modelValue:a(t).biodata.no_hp_ortu,"onUpdate:modelValue":o[10]||(o[10]=r=>a(t).biodata.no_hp_ortu=r),error:a(_)("no_hp_ortu"),name:"no_hp_ortu",inputmode:"text",required:""},null,8,["modelValue","error"]),e("div",{innerHTML:a(d)("no_hp_ortu")},null,8,Ie)]),e("div",Ae,[e("button",{class:"flex justify-center rounded border border-stroke py-2 px-6 font-medium text-black hover:shadow-1 dark:border-strokedark dark:text-white",type:"button",onClick:v}," Batal "),e("button",{class:"flex justify-center rounded bg-primary py-2 px-6 font-medium text-white hover:bg-opacity-90",type:"submit",disabled:a(m)},[e("span",$e,[l(G,{loading:a(m),size:"xs",class:$(["transition-transform duration-300 ease-in-out",a(m)?"translate-x-[-10px]":"translate-x-0"])},null,8,["loading","class"]),o[12]||(o[12]=O(" Simpan "))])],8,Be)])],32)])):C("",!0)])]),a(t).biodata?(V(),H("div",Oe,[e("div",ze,[o[18]||(o[18]=e("div",{class:"border-b border-stroke py-4 px-7 dark:border-strokedark"},[e("h3",{class:"font-medium text-black dark:text-white"},"Perbarui Foto")],-1)),e("div",Ge,[e("form",{onSubmit:U(D,["prevent"])},[e("div",{id:"FileUpload",class:$([{"border-green-500":L.value,"border-primary":!L.value},"relative mb-3 block w-full cursor-pointer appearance-none rounded border-2 border-dashed bg-gray py-4 px-4 dark:bg-meta-4 sm:py-7.5"]),onDragover:U(X,["prevent"]),onDragleave:U(Z,["prevent"]),onDrop:U(ee,["prevent"])},[e("input",{type:"file",accept:"image/*",class:"absolute inset-0 z-50 m-0 h-full w-full cursor-pointer p-0 opacity-0 outline-none",onChange:R},null,32),e("div",We,[e("span",Ke,[l(z,{name:"add-photo"})]),o[14]||(o[14]=e("p",{class:"text-sm font-medium items-center justify-center"},[e("span",{class:"text-primary"},"Click untuk memilih foto")],-1)),o[15]||(o[15]=e("p",{class:"text-sm font-medium items-center justify-center"},"atau seret foto ke kotak ini",-1)),o[16]||(o[16]=e("p",{class:"mt-1.5 text-sm font-medium"},"JPG atau JPEG",-1))])],34),e("div",{class:"mb-3",innerHTML:a(d)("foto")},null,8,Je),u.value?(V(),H("div",Re,[e("img",{src:M.value,alt:"Image Preview",class:"max-w-full h-auto rounded"},null,8,Ye),a(E)?(V(),H("div",Qe,[e("div",{class:"radial-progress text-primary",style:te({"--value":a(F)}),role:"progressbar"},re(a(F))+"%",5)])):C("",!0)])):C("",!0),e("div",Xe,[e("button",{class:"flex justify-center rounded border border-stroke py-2 px-6 font-medium text-black hover:shadow-1 dark:border-strokedark dark:text-white",type:"button",onClick:Y}," Cancel "),e("button",{class:"flex justify-center rounded bg-primary py-2 px-6 font-medium text-white hover:bg-opacity-90",onClick:D,type:"button",disabled:a(E)||!k.value},[e("span",ea,[l(G,{loading:a(E),size:"xs"},null,8,["loading"]),o[17]||(o[17]=O(" Simpan Foto "))])],8,Ze)])],32)])])])):C("",!0)]))}}),oa={class:"mx-auto max-w-270"},_a=K({__name:"BiodataView",setup(y){const s=b("Biodata"),f=q();return J(()=>{f.clearErrors()}),(n,t)=>(V(),se(ie,null,{default:le(()=>[e("div",oa,[l(oe,{pageTitle:s.value},null,8,["pageTitle"]),l(aa)])]),_:1}))}});export{_a as default};
