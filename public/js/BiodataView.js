import{_ as oe}from"./BreadcrumbDefault.vue_vue_type_script_setup_true_lang.js";import{h as c,v as W,x as N,E as D,d as K,B as A,i as J,o as w,c as S,e,u as a,l as U,f as l,s as $,g as z,q as E,k as te,t as re,b as se,w as le}from"../index.js";import{s as V}from"./toast.js";import{u as j}from"./formValidationErrors.js";import{C as ne}from"./component.js";import{u as ie}from"./useSmoothScrollToTop.js";import{_ as O}from"./HeroIcon.vue_vue_type_script_setup_true_lang.js";import{f as i}from"./fieldErrorHtml.js";import{_ as G}from"./SpinnerLoading.vue_vue_type_script_setup_true_lang.js";import{h as b}from"./hasError.js";import{I as f}from"./InputGroup.js";import{_ as de}from"./DefaultLayout.vue_vue_type_script_setup_true_lang.js";import"./_plugin-vue_export-helper.js";import"./authComposable.js";import"./logo-ppdb.js";function ue(){const T=c(0),s=c(!1),h=c(!1),v=c(null),t=c(!1),M=D.UPDATE_PHOTO_SISWA,k=D.ME_SISWA,d=W(),y=j();return{uploadPhoto:async P=>{var u,m;T.value=0,v.value=null,t.value=!1;const x=new FormData;x.append("foto",P);try{s.value=!0;const p=await N.post(M,x,{onUploadProgress:g=>{g.total&&(T.value=Math.round(g.loaded*100/g.total))}});if(p.data.success){const g=p.data.data;return d.biodata&&(d.biodata.thumbnail_url=g.thumbnail_url,d.biodata.foto_url=g.foto_url),t.value=!0,!0}else return y.errors=p.data.errors,!1}catch(p){return v.value=((m=(u=p.response)==null?void 0:u.data)==null?void 0:m.message)||"An error occurred during upload.",y.errors=p.response.data.errors,!1}finally{s.value=!1}},loadingUpdatePhoto:s,uploadProgress:T,uploadError:v,uploadSuccess:t,updateProfile:async P=>{var x,u;v.value=null,h.value=!0;try{const m=await N.patch(k,P);if(m.data.success){const p=m.data.data;return d.biodata&&(d.biodata=p.biodata,d.user=p.user),!0}else return y.errors=m.data.errors,!1}catch(m){return console.error("Update profile error:",m.response),y.errors=((u=(x=m.response)==null?void 0:x.data)==null?void 0:u.errors)||{},!1}finally{h.value=!1}},loadingUpdateProfile:h}}const me={class:"grid grid-cols-5 gap-8"},pe={class:"col-span-5 xl:col-span-3"},ce={class:"rounded-sm border border-stroke bg-white shadow-default dark:border-strokedark dark:bg-boxdark"},be={key:0,class:"p-7"},fe={class:"mb-3"},_e=["innerHTML"],he={class:"mb-3"},ge=["innerHTML"],ve={class:"mb-3"},ke=["innerHTML"],xe={class:"mb-3"},ye=["innerHTML"],Ve={class:"mb-3"},we=["innerHTML"],Te={class:"mb-3"},Me=["innerHTML"],Pe={class:"grid grid-cols-1 md:grid-cols-5 gap-6 mb-3"},Le={class:"md:col-span-3 flex flex-col"},He=["innerHTML"],Se={class:"md:col-span-2 flex flex-col"},Ue={class:"relative flex-grow"},Ce={class:"absolute right-3 top-1/2 transform -translate-y-1/2 cursor-pointer text-primary"},Ee=["innerHTML"],Fe={class:"mb-3"},Ne=["innerHTML"],De={class:"mb-3"},je=["innerHTML"],qe={class:"mb-3"},Ie=["innerHTML"],Be={class:"flex justify-end gap-4.5"},Ae=["disabled"],$e={class:"flex items-center gap-2"},ze={key:0,class:"col-span-5 xl:col-span-2"},Oe={class:"rounded-sm border border-stroke bg-white shadow-default dark:border-strokedark dark:bg-boxdark"},Ge={class:"p-7"},We={class:"flex flex-col items-center justify-center space-y-3"},Ke={class:"text-primary flex h-10 w-10 items-center justify-center rounded-full bg-white dark:bg-meta-4"},Je=["innerHTML"],Re={key:0,class:"relative mt-4 flex items-center justify-center mb-3"},Ye=["src"],Qe={key:0,class:"absolute inset-0 flex items-center justify-center bg-black bg-opacity-50 rounded"},Xe={class:"flex justify-end gap-4.5"},Ze=["disabled"],ea={class:"flex items-center gap-2"},aa=K({__name:"FormBiodata",setup(T){const s=W(),{smoothScrollToTop:h}=ie(),v=j();let t=A({user:s.user?{...s.user}:null,biodata:s.biodata?{...s.biodata}:null});const M=c(""),k=c(null),d=c(!1),{uploadPhoto:y,loadingUpdatePhoto:C,uploadProgress:F,updateProfile:P,uploadError:x,loadingUpdateProfile:u}=ue(),m=async()=>{var H,B;v.clearErrors();const{foto:n,...o}=t.biodata,r={...o,username:(H=t.user)==null?void 0:H.username,email:(B=t.user)==null?void 0:B.email};u.value=!0,await P(r).catch(ae=>{V({message:"Profile update failed "+ae.message,type:"error"})}).finally(()=>{u.value=!1})?V({message:"Profile updated"}):V({message:"Profile update failed",type:"error"}),h("#sangkonten")},p=()=>{t.user=s.user?{...s.user}:null,t.biodata=s.biodata?{...s.biodata}:null},g=()=>{p()},q=async()=>{await y(k.value)?V({message:"Foto berhasil diperbarui"}):V({message:"Gagal update foto, "+x.value,type:"error"}),d.value=!1,k.value=null,h("#sangkonten")},R=n=>{var _;const o=n.target,r=(_=o.files)==null?void 0:_[0];r?I(r):M.value="kosong",o.value=""},Y=()=>{k.value=null,d.value=!1,t.biodata.thumbnail_url=s.biodata.thumbnail_url},Q=c({allowInput:!0,format:"d-m-Y"}),L=c(!1),X=()=>{L.value=!0},Z=()=>{L.value=!1},ee=n=>{var r,_;L.value=!1;const o=(_=(r=n.dataTransfer)==null?void 0:r.files)==null?void 0:_[0];o&&I(o)},I=n=>{if(!n.type.startsWith("image/")){V({message:"File harus berupa gambar",type:"error"});return}const o=new FileReader;o.onload=r=>{var _,H;M.value=(_=r.target)==null?void 0:_.result,t.biodata.thumbnail_url=(H=r.target)==null?void 0:H.result},o.readAsDataURL(n),k.value=n,d.value=!0};return J(async()=>{s.biodata||await N.get(D.ME_SISWA).then(n=>{const o=n.data.data;s.biodata=o.biodata,s.user=o.user,t=A({user:s.user?{...s.user}:null,biodata:s.biodata?{...s.biodata}:null})})}),(n,o)=>(w(),S("div",me,[e("div",pe,[e("div",ce,[o[13]||(o[13]=e("div",{class:"border-b border-stroke py-4 px-7 dark:border-strokedark"},[e("h3",{class:"font-medium text-black dark:text-white"},"Personal Information")],-1)),a(t).biodata?(w(),S("div",be,[e("form",{onSubmit:U(m,["prevent"])},[e("div",fe,[l(f,{label:"Nomor Induk Siswa Nasional",modelValue:a(t).biodata.nisn,"onUpdate:modelValue":o[0]||(o[0]=r=>a(t).biodata.nisn=r),error:a(b)("nisn"),name:"nisn",inputmode:"numeric",required:""},null,8,["modelValue","error"]),e("div",{innerHTML:a(i)("nisn")},null,8,_e)]),e("div",he,[l(f,{label:"Nomor Induk Kependudukan",modelValue:a(t).biodata.nik,"onUpdate:modelValue":o[1]||(o[1]=r=>a(t).biodata.nik=r),error:a(b)("nik"),name:"nik",inputmode:"numeric",required:""},null,8,["modelValue","error"]),e("div",{innerHTML:a(i)("nik")},null,8,ge)]),e("div",ve,[l(f,{label:"Nomor Kartu Keluarga",modelValue:a(t).biodata.no_kk,"onUpdate:modelValue":o[2]||(o[2]=r=>a(t).biodata.no_kk=r),error:a(b)("no_kk"),name:"no_kk",inputmode:"numeric",required:""},null,8,["modelValue","error"]),e("div",{innerHTML:a(i)("no_kk")},null,8,ke)]),e("div",xe,[l(f,{label:"Nama",modelValue:a(t).biodata.nama,"onUpdate:modelValue":o[3]||(o[3]=r=>a(t).biodata.nama=r),error:a(b)("nama"),name:"nama",inputmode:"text",required:""},null,8,["modelValue","error"]),e("div",{innerHTML:a(i)("nama")},null,8,ye)]),e("div",Ve,[l(f,{label:"Email",modelValue:a(t).user.email,"onUpdate:modelValue":o[4]||(o[4]=r=>a(t).user.email=r),error:a(b)("email"),name:"email",type:"email",inputmode:"email",required:""},null,8,["modelValue","error"]),e("div",{innerHTML:a(i)("email")},null,8,we)]),e("div",Te,[l(f,{label:"Username",modelValue:a(t).user.username,"onUpdate:modelValue":o[5]||(o[5]=r=>a(t).user.username=r),error:a(b)("username"),name:"username",inputmode:"text",required:""},null,8,["modelValue","error"]),e("div",{innerHTML:a(i)("username")},null,8,Me)]),e("div",Pe,[e("div",Le,[l(f,{class:"h-full",label:"Tempat Lahir",modelValue:a(t).biodata.tempat_lahir,"onUpdate:modelValue":o[6]||(o[6]=r=>a(t).biodata.tempat_lahir=r),error:a(b)("tempat_lahir"),name:"tempat_lahir",inputmode:"text",required:""},null,8,["modelValue","error"]),e("div",{innerHTML:a(i)("tempat_lahir")},null,8,He)]),e("div",Se,[o[11]||(o[11]=e("label",{class:"mb-1 block text-black dark:text-white",for:"tanggal-lahir"}," Tanggal Lahir ",-1)),e("div",Ue,[l(a(ne),{modelValue:a(t).biodata.tanggal_lahir,"onUpdate:modelValue":o[7]||(o[7]=r=>a(t).biodata.tanggal_lahir=r),class:"w-full rounded border border-stroke bg-gray py-1 px-2.5 font-normal text-black focus:border-primary focus-visible:outline-none dark:border-strokedark dark:bg-meta-4 dark:text-white dark:focus:border-primary h-full",config:Q.value,id:"tanggal-lahir"},null,8,["modelValue","config"]),e("span",Ce,[l(O,{name:"calendar-search",class:"w-5 h-5"})])]),e("div",{innerHTML:a(i)("tanggal_lahir")},null,8,Ee)])]),e("div",Fe,[l(f,{label:"Nama Ayah",modelValue:a(t).biodata.nama_bapak,"onUpdate:modelValue":o[8]||(o[8]=r=>a(t).biodata.nama_bapak=r),error:a(b)("nama_bapak"),name:"nama_bapak",inputmode:"text",required:""},null,8,["modelValue","error"]),e("div",{innerHTML:a(i)("nama_bapak")},null,8,Ne)]),e("div",De,[l(f,{label:"Nama Ibu",modelValue:a(t).biodata.nama_ibu,"onUpdate:modelValue":o[9]||(o[9]=r=>a(t).biodata.nama_ibu=r),error:a(b)("nama_ibu"),name:"nama_ibu",inputmode:"text",required:""},null,8,["modelValue","error"]),e("div",{innerHTML:a(i)("nama_ibu")},null,8,je)]),e("div",qe,[l(f,{label:"No. HP Orang Tua",modelValue:a(t).biodata.no_hp_ortu,"onUpdate:modelValue":o[10]||(o[10]=r=>a(t).biodata.no_hp_ortu=r),error:a(b)("no_hp_ortu"),name:"no_hp_ortu",inputmode:"text",required:""},null,8,["modelValue","error"]),e("div",{innerHTML:a(i)("no_hp_ortu")},null,8,Ie)]),e("div",Be,[e("button",{class:"flex justify-center rounded border border-stroke py-2 px-6 font-medium text-black hover:shadow-1 dark:border-strokedark dark:text-white",type:"button",onClick:g}," Batal "),e("button",{class:"flex justify-center rounded bg-primary py-2 px-6 font-medium text-white hover:bg-opacity-90",type:"submit",disabled:a(u)},[e("span",$e,[l(G,{loading:a(u),size:"xs",class:$(["transition-transform duration-300 ease-in-out",a(u)?"translate-x-[-10px]":"translate-x-0"])},null,8,["loading","class"]),o[12]||(o[12]=z(" Simpan "))])],8,Ae)])],32)])):E("",!0)])]),a(t).biodata?(w(),S("div",ze,[e("div",Oe,[o[18]||(o[18]=e("div",{class:"border-b border-stroke py-4 px-7 dark:border-strokedark"},[e("h3",{class:"font-medium text-black dark:text-white"},"Perbarui Foto")],-1)),e("div",Ge,[e("form",{onSubmit:U(q,["prevent"])},[e("div",{id:"FileUpload",class:$([{"border-green-500":L.value,"border-primary":!L.value},"relative mb-3 block w-full cursor-pointer appearance-none rounded border-2 border-dashed bg-gray py-4 px-4 dark:bg-meta-4 sm:py-7.5"]),onDragover:U(X,["prevent"]),onDragleave:U(Z,["prevent"]),onDrop:U(ee,["prevent"])},[e("input",{type:"file",accept:"image/*",class:"absolute inset-0 z-50 m-0 h-full w-full cursor-pointer p-0 opacity-0 outline-none",onChange:R},null,32),e("div",We,[e("span",Ke,[l(O,{name:"add-photo"})]),o[14]||(o[14]=e("p",{class:"text-sm font-medium items-center justify-center"},[e("span",{class:"text-primary"},"Click untuk memilih foto")],-1)),o[15]||(o[15]=e("p",{class:"text-sm font-medium items-center justify-center"},"atau seret foto ke kotak ini",-1)),o[16]||(o[16]=e("p",{class:"mt-1.5 text-sm font-medium"},"JPG atau JPEG",-1))])],34),e("div",{class:"mb-3",innerHTML:a(i)("foto")},null,8,Je),d.value?(w(),S("div",Re,[e("img",{src:M.value,alt:"Image Preview",class:"max-w-full h-auto rounded"},null,8,Ye),a(C)?(w(),S("div",Qe,[e("div",{class:"radial-progress text-primary",style:te({"--value":a(F)}),role:"progressbar"},re(a(F))+"%",5)])):E("",!0)])):E("",!0),e("div",Xe,[e("button",{class:"flex justify-center rounded border border-stroke py-2 px-6 font-medium text-black hover:shadow-1 dark:border-strokedark dark:text-white",type:"button",onClick:Y}," Cancel "),e("button",{class:"flex justify-center rounded bg-primary py-2 px-6 font-medium text-white hover:bg-opacity-90",onClick:q,type:"button",disabled:a(C)||!k.value},[e("span",ea,[l(G,{loading:a(C),size:"xs"},null,8,["loading"]),o[17]||(o[17]=z(" Simpan Foto "))])],8,Ze)])],32)])])])):E("",!0)]))}}),oa={class:"mx-auto max-w-270"},ga=K({__name:"BiodataView",setup(T){const s=c("Biodata"),h=j();return J(()=>{h.clearErrors()}),(v,t)=>(w(),se(de,null,{default:le(()=>[e("div",oa,[l(oe,{pageTitle:s.value},null,8,["pageTitle"]),l(aa)])]),_:1}))}});export{ga as default};
//# sourceMappingURL=BiodataView.js.map
