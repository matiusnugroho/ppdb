import{_ as te}from"./BreadcrumbDefault.vue_vue_type_script_setup_true_lang.js";import{g as b,u as q,l as j,E as D,f as G,m as $,j as K,o as M,c as H,a as e,p as a,q as V,s as f,v as k,d as v,e as O,i as N,n as ae,x as re,t as oe,k as se,w as le}from"../index.js";import{s as T}from"./toast.js";import{u as F}from"./formValidationErrors.js";import{C as ne}from"./component.js";import{_ as z}from"./HeroIcon.vue_vue_type_script_setup_true_lang.js";import{f as d}from"./fieldErrorHtml.js";import{_ as W}from"./SpinnerLoading.vue_vue_type_script_setup_true_lang.js";import{_ as de}from"./DefaultLayout.vue_vue_type_script_setup_true_lang.js";import"./_plugin-vue_export-helper.js";import"./authComposable.js";function ie(){const _=b(0),s=b(!1),p=b(!1),l=b(null),r=b(!1),L=D.UPDATE_PHOTO_SISWA,y=D.ME_SISWA,i=q(),w=F();return{uploadPhoto:async P=>{var c,u;_.value=0,l.value=null,r.value=!1;const h=new FormData;h.append("foto",P);try{s.value=!0;const m=await j.post(L,h,{onUploadProgress:x=>{x.total&&(_.value=Math.round(x.loaded*100/x.total))}});if(m.data.success){const x=m.data.data;return i.biodata&&(i.biodata.thumbnail_url=x.thumbnail_url,i.biodata.foto_url=x.foto_url),r.value=!0,!0}else return w.errors=m.data.errors,!1}catch(m){return l.value=((u=(c=m.response)==null?void 0:c.data)==null?void 0:u.message)||"An error occurred during upload.",w.errors=m.response.data.errors,!1}finally{s.value=!1}},loadingUpdatePhoto:s,uploadProgress:_,uploadError:l,uploadSuccess:r,updateProfile:async P=>{var h,c;l.value=null,p.value=!0;try{const u=await j.patch(y,P);if(u.data.success){const m=u.data.data;return i.biodata&&(i.biodata=m.biodata,i.user=m.user),!0}else return w.errors=u.data.errors,!1}catch(u){return console.error("Update profile error:",u.response),w.errors=((c=(h=u.response)==null?void 0:h.data)==null?void 0:c.errors)||{},!1}finally{p.value=!1}},loadingUpdateProfile:p}}function ue(){return{smoothScrollToTop:(s,p)=>{try{const l=document.querySelector(s);if(l){const r={top:0,behavior:"smooth",...p};l.scrollTo(r)}else console.warn(`Element with selector ${s} not found.`)}catch(l){console.error("Error in smoothScrollToTop:",l)}}}}const me={class:"grid grid-cols-5 gap-8"},be={class:"col-span-5 xl:col-span-3"},pe={class:"rounded-sm border border-stroke bg-white shadow-default dark:border-strokedark dark:bg-boxdark"},ce={key:0,class:"p-7"},fe={class:"mb-5.5"},ke=["innerHTML"],ge={class:"mb-5.5"},xe=["innerHTML"],ye={class:"mb-5.5"},he=["innerHTML"],ve={class:"mb-5.5"},_e=["innerHTML"],we={class:"mb-5.5"},Te=["innerHTML"],Me={class:"mb-5.5"},Le=["innerHTML"],Pe={class:"grid grid-cols-1 md:grid-cols-5 gap-6 mb-5.5"},Ue={class:"md:col-span-3"},Se=["innerHTML"],He={class:"md:col-span-2"},Ve={class:"relative"},Ee={class:"absolute right-3 top-1/2 transform -translate-y-1/2 cursor-pointer text-primary"},Ne=["innerHTML"],Ce={class:"mb-5.5"},je=["innerHTML"],De={class:"mb-5.5"},Fe=["innerHTML"],Ae={class:"mb-5.5"},Ie=["innerHTML"],Be={class:"flex justify-end gap-4.5"},$e=["disabled"],Oe={class:"flex items-center gap-2"},ze={key:0,class:"col-span-5 xl:col-span-2"},We={class:"rounded-sm border border-stroke bg-white shadow-default dark:border-strokedark dark:bg-boxdark"},qe={class:"p-7"},Ge={class:"mb-4 flex items-center gap-3"},Ke={class:"h-14 w-14 rounded-full"},Je=["src"],Re={class:"flex flex-col items-center justify-center space-y-3"},Ye={class:"text-primary flex h-10 w-10 items-center justify-center rounded-full bg-white dark:bg-meta-4"},Qe=["innerHTML"],Xe={key:0,class:"relative mt-4 flex items-center justify-center mb-3"},Ze=["src"],et={key:0,class:"absolute inset-0 flex items-center justify-center bg-black bg-opacity-50 rounded"},tt={class:"flex justify-end gap-4.5"},at=["disabled"],rt={class:"flex items-center gap-2"},ot=G({__name:"FormBiodata",setup(_){const s=q(),{smoothScrollToTop:p}=ue(),l=F();let r=$({user:s.user?{...s.user}:null,biodata:s.biodata?{...s.biodata}:null});const L=b(""),y=b(null),i=b(!1),{uploadPhoto:w,loadingUpdatePhoto:E,uploadProgress:C,updateProfile:P,uploadError:h,loadingUpdateProfile:c}=ie(),u=async()=>{var S,B;l.clearErrors();const{foto:n,...t}=r.biodata,o={...t,username:(S=r.user)==null?void 0:S.username,email:(B=r.user)==null?void 0:B.email};c.value=!0,await P(o).catch(ee=>{T({message:"Profile update failed "+ee.message,type:"error"})}).finally(()=>{c.value=!1})?T({message:"Profile updated"}):T({message:"Profile update failed",type:"error"}),p("#sangkonten")},m=()=>{r.user=s.user?{...s.user}:null,r.biodata=s.biodata?{...s.biodata}:null},x=()=>{m()},A=async()=>{await w(y.value)?T({message:"Foto berhasil diperbarui"}):T({message:"Gagal update foto, "+h.value,type:"error"}),i.value=!1,y.value=null,p("#sangkonten")},J=n=>{var g;const t=n.target,o=(g=t.files)==null?void 0:g[0];o?I(o):L.value="kosong",t.value=""},R=()=>{y.value=null,i.value=!1,r.biodata.thumbnail_url=s.biodata.thumbnail_url},Y=b({allowInput:!0,format:"d-m-Y"}),U=b(!1),Q=()=>{U.value=!0},X=()=>{U.value=!1},Z=n=>{var o,g;U.value=!1;const t=(g=(o=n.dataTransfer)==null?void 0:o.files)==null?void 0:g[0];t&&I(t)},I=n=>{if(!n.type.startsWith("image/")){T({message:"File harus berupa gambar",type:"error"});return}const t=new FileReader;t.onload=o=>{var g,S;L.value=(g=o.target)==null?void 0:g.result,r.biodata.thumbnail_url=(S=o.target)==null?void 0:S.result},t.readAsDataURL(n),y.value=n,i.value=!0};return K(async()=>{s.biodata||await j.get(D.ME_SISWA).then(n=>{const t=n.data.data;s.biodata=t.biodata,s.user=t.user,r=$({user:s.user?{...s.user}:null,biodata:s.biodata?{...s.biodata}:null})})}),(n,t)=>(M(),H("div",me,[e("div",be,[e("div",pe,[t[23]||(t[23]=e("div",{class:"border-b border-stroke py-4 px-7 dark:border-strokedark"},[e("h3",{class:"font-medium text-black dark:text-white"},"Personal Information")],-1)),a(r).biodata?(M(),H("div",ce,[e("form",{onSubmit:V(u,["prevent"])},[e("div",fe,[t[11]||(t[11]=e("label",{class:"mb-3 block text-sm font-medium text-black dark:text-white",for:"nisn"},"NISN",-1)),f(e("input",{"onUpdate:modelValue":t[0]||(t[0]=o=>a(r).biodata.nisn=o),class:"w-full rounded border border-stroke bg-gray py-3 px-4.5 font-normal text-black focus:border-primary focus-visible:outline-none dark:border-strokedark dark:bg-meta-4 dark:text-white dark:focus:border-primary",type:"text",name:"nisn",id:"nisn",inputmode:"numeric"},null,512),[[k,a(r).biodata.nisn]]),e("div",{innerHTML:a(d)("nisn")},null,8,ke)]),e("div",ge,[t[12]||(t[12]=e("label",{class:"mb-3 block text-sm font-medium text-black dark:text-white",for:"nik"},"NIK",-1)),f(e("input",{"onUpdate:modelValue":t[1]||(t[1]=o=>a(r).biodata.nik=o),class:"w-full rounded border border-stroke bg-gray py-3 px-4.5 font-normal text-black focus:border-primary focus-visible:outline-none dark:border-strokedark dark:bg-meta-4 dark:text-white dark:focus:border-primary",type:"text",name:"nik",id:"nik",inputmode:"numeric"},null,512),[[k,a(r).biodata.nik]]),e("div",{innerHTML:a(d)("nik")},null,8,xe)]),e("div",ye,[t[13]||(t[13]=e("label",{class:"mb-3 block text-sm font-medium text-black dark:text-white",for:"nik"},"No. Kartu Keluarga",-1)),f(e("input",{"onUpdate:modelValue":t[2]||(t[2]=o=>a(r).biodata.no_kk=o),class:"w-full rounded border border-stroke bg-gray py-3 px-4.5 font-normal text-black focus:border-primary focus-visible:outline-none dark:border-strokedark dark:bg-meta-4 dark:text-white dark:focus:border-primary",type:"text",name:"no_kk",id:"no_kk",inputmode:"numeric"},null,512),[[k,a(r).biodata.no_kk]]),e("div",{innerHTML:a(d)("no_kk")},null,8,he)]),e("div",ve,[t[14]||(t[14]=e("label",{class:"mb-3 block text-sm font-medium text-black dark:text-white",for:"fullName"},"Nama",-1)),f(e("input",{"onUpdate:modelValue":t[3]||(t[3]=o=>a(r).biodata.nama=o),class:"w-full rounded border border-stroke bg-gray py-3 font-normal text-black focus:border-primary focus-visible:outline-none dark:border-strokedark dark:bg-meta-4 dark:text-white dark:focus:border-primary",type:"text",name:"fullName",id:"fullName"},null,512),[[k,a(r).biodata.nama]]),e("div",{innerHTML:a(d)("nama")},null,8,_e)]),e("div",we,[t[15]||(t[15]=e("label",{class:"mb-3 block text-sm font-medium text-black dark:text-white",for:"emailAddress"},"Email Address",-1)),f(e("input",{"onUpdate:modelValue":t[4]||(t[4]=o=>a(r).user.email=o),class:"w-full rounded border border-stroke bg-gray py-3 pr-4.5 font-normal text-black focus:border-primary focus-visible:outline-none dark:border-strokedark dark:bg-meta-4 dark:text-white dark:focus:border-primary",type:"email",name:"emailAddress",id:"emailAddress",inputmode:"email"},null,512),[[k,a(r).user.email]]),e("div",{innerHTML:a(d)("email")},null,8,Te)]),e("div",Me,[t[16]||(t[16]=e("label",{class:"mb-3 block text-sm font-medium text-black dark:text-white",for:"Username"},"Username",-1)),f(e("input",{"onUpdate:modelValue":t[5]||(t[5]=o=>a(r).user.username=o),class:"w-full rounded border border-stroke bg-gray py-3 px-4.5 font-normal text-black focus:border-primary focus-visible:outline-none dark:border-strokedark dark:bg-meta-4 dark:text-white dark:focus:border-primary",type:"text",name:"Username",id:"Username",placeholder:"devidjhon24"},null,512),[[k,a(r).user.username]]),e("div",{innerHTML:a(d)("username")},null,8,Le)]),e("div",Pe,[e("div",Ue,[t[17]||(t[17]=e("label",{class:"mb-3 block text-sm font-medium text-black dark:text-white",for:"tempat_lahir"}," Tempat Lahir ",-1)),f(e("input",{"onUpdate:modelValue":t[6]||(t[6]=o=>a(r).biodata.tempat_lahir=o),class:"w-full rounded border border-stroke bg-gray py-3 px-4.5 font-normal text-black focus:border-primary focus-visible:outline-none dark:border-strokedark dark:bg-meta-4 dark:text-white dark:focus:border-primary",type:"text",name:"tempat_lahir",id:"tempat_lahir",placeholder:"Tempat lahir anda"},null,512),[[k,a(r).biodata.tempat_lahir]]),e("div",{innerHTML:a(d)("tempat_lahir")},null,8,Se)]),e("div",He,[t[18]||(t[18]=e("label",{class:"mb-3 block text-sm font-medium text-black dark:text-white",for:"tanggal-lahir"}," Tanggal Lahir ",-1)),e("div",Ve,[v(a(ne),{modelValue:a(r).biodata.tanggal_lahir,"onUpdate:modelValue":t[7]||(t[7]=o=>a(r).biodata.tanggal_lahir=o),class:"w-full rounded border border-stroke bg-gray py-3 px-4.5 font-normal text-black focus:border-primary focus-visible:outline-none dark:border-strokedark dark:bg-meta-4 dark:text-white dark:focus:border-primary",config:Y.value,id:"tanggal-lahir"},null,8,["modelValue","config"]),e("span",Ee,[v(z,{name:"calendar-search",class:"w-5 h-5"})])]),e("div",{innerHTML:a(d)("tanggal_lahir")},null,8,Ne)])]),e("div",Ce,[t[19]||(t[19]=e("label",{class:"mb-3 block text-sm font-medium text-black dark:text-white",for:"Username"},"Nama Bapak",-1)),f(e("input",{"onUpdate:modelValue":t[8]||(t[8]=o=>a(r).biodata.nama_bapak=o),class:"w-full rounded border border-stroke bg-gray py-3 px-4.5 font-normal text-black focus:border-primary focus-visible:outline-none dark:border-strokedark dark:bg-meta-4 dark:text-white dark:focus:border-primary",type:"text",name:"nama_bapak",id:"nama_bapak"},null,512),[[k,a(r).biodata.nama_bapak]]),e("div",{innerHTML:a(d)("nama_bapak")},null,8,je)]),e("div",De,[t[20]||(t[20]=e("label",{class:"mb-3 block text-sm font-medium text-black dark:text-white",for:"Username"},"Nama Ibu",-1)),f(e("input",{"onUpdate:modelValue":t[9]||(t[9]=o=>a(r).biodata.nama_ibu=o),class:"w-full rounded border border-stroke bg-gray py-3 px-4.5 font-normal text-black focus:border-primary focus-visible:outline-none dark:border-strokedark dark:bg-meta-4 dark:text-white dark:focus:border-primary",type:"text",name:"nama_ibu",id:"nama_ibu"},null,512),[[k,a(r).biodata.nama_ibu]]),e("div",{innerHTML:a(d)("nama_ibu")},null,8,Fe)]),e("div",Ae,[t[21]||(t[21]=e("label",{class:"mb-3 block text-sm font-medium text-black dark:text-white",for:"Username"},"No. Hp Orang Tua",-1)),f(e("input",{"onUpdate:modelValue":t[10]||(t[10]=o=>a(r).biodata.no_hp_ortu=o),class:"w-full rounded border border-stroke bg-gray py-3 px-4.5 font-normal text-black focus:border-primary focus-visible:outline-none dark:border-strokedark dark:bg-meta-4 dark:text-white dark:focus:border-primary",type:"text",name:"no_hp_ortu",id:"no_hp_ortu"},null,512),[[k,a(r).biodata.no_hp_ortu]]),e("div",{innerHTML:a(d)("no_hp_ortu")},null,8,Ie)]),e("div",Be,[e("button",{class:"flex justify-center rounded border border-stroke py-2 px-6 font-medium text-black hover:shadow-1 dark:border-strokedark dark:text-white",type:"button",onClick:x}," Batal "),e("button",{class:"flex justify-center rounded bg-primary py-2 px-6 font-medium text-white hover:bg-opacity-90",type:"submit",disabled:a(c)},[e("span",Oe,[v(W,{loading:a(c),size:"xs"},null,8,["loading"]),t[22]||(t[22]=O(" Simpan "))])],8,$e)])],32)])):N("",!0)])]),a(r).biodata?(M(),H("div",ze,[e("div",We,[t[29]||(t[29]=e("div",{class:"border-b border-stroke py-4 px-7 dark:border-strokedark"},[e("h3",{class:"font-medium text-black dark:text-white"},"Your Photo")],-1)),e("div",qe,[e("form",{onSubmit:V(A,["prevent"])},[e("div",Ge,[e("div",Ke,[e("img",{src:a(r).biodata.thumbnail_url,alt:"User"},null,8,Je)]),t[24]||(t[24]=e("div",null,[e("span",{class:"mb-1.5 font-medium text-black dark:text-white"},"Edit Foto")],-1))]),e("div",{id:"FileUpload",class:ae([{"border-green-500":U.value,"border-primary":!U.value},"relative mb-5.5 block w-full cursor-pointer appearance-none rounded border-2 border-dashed bg-gray py-4 px-4 dark:bg-meta-4 sm:py-7.5"]),onDragover:V(Q,["prevent"]),onDragleave:V(X,["prevent"]),onDrop:V(Z,["prevent"])},[e("input",{type:"file",accept:"image/*",class:"absolute inset-0 z-50 m-0 h-full w-full cursor-pointer p-0 opacity-0 outline-none",onChange:J},null,32),e("div",Re,[e("span",Ye,[v(z,{name:"add-photo"})]),t[25]||(t[25]=e("p",{class:"text-sm font-medium items-center justify-center"},[e("span",{class:"text-primary"},"Click untuk memilih foto")],-1)),t[26]||(t[26]=e("p",{class:"text-sm font-medium items-center justify-center"},"atau seret foto ke kotak ini",-1)),t[27]||(t[27]=e("p",{class:"mt-1.5 text-sm font-medium"},"JPG atau JPEG",-1))])],34),e("div",{class:"mb-5.5",innerHTML:a(d)("foto")},null,8,Qe),i.value?(M(),H("div",Xe,[e("img",{src:L.value,alt:"Image Preview",class:"max-w-full h-auto rounded"},null,8,Ze),a(E)?(M(),H("div",et,[e("div",{class:"radial-progress text-primary",style:re({"--value":a(C)}),role:"progressbar"},oe(a(C))+"%",5)])):N("",!0)])):N("",!0),e("div",tt,[e("button",{class:"flex justify-center rounded border border-stroke py-2 px-6 font-medium text-black hover:shadow-1 dark:border-strokedark dark:text-white",type:"button",onClick:R}," Cancel "),e("button",{class:"flex justify-center rounded bg-primary py-2 px-6 font-medium text-white hover:bg-opacity-90",onClick:A,type:"button",disabled:a(E)||!y.value},[e("span",rt,[v(W,{loading:a(E),size:"xs"},null,8,["loading"]),t[28]||(t[28]=O(" Simpan Foto "))])],8,at)])],32)])])])):N("",!0)]))}}),st={class:"mx-auto max-w-270"},gt=G({__name:"BiodataView",setup(_){const s=b("Biodata"),p=F();return K(()=>{p.clearErrors()}),(l,r)=>(M(),se(de,null,{default:le(()=>[e("div",st,[v(te,{pageTitle:s.value},null,8,["pageTitle"]),v(ot)])]),_:1}))}});export{gt as default};
