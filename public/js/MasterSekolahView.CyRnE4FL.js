import{_ as re,a as ie}from"./DefaultLayout.vue_vue_type_script_setup_true_lang.RdvziuN4.js";import{d as A,h as f,P as ue,l as C,o as Z,a as m,c as p,b as e,t as g,j as E,e as r,D as ee,H as me,F as D,k as U,g as _,f as ae,A as pe,E as ge,C as S,B as W,r as be,u as P,n as X,w as q,p as ce}from"../index.js";import{S as fe,b as ke}from"./buatOption.BTQFN8sK.js";import{F as Y}from"./FilterSelect.B9v0oc3M.js";import{_ as ve}from"./NoDataComponent.vue_vue_type_script_setup_true_lang.0N8bNYdP.js";import{I as c}from"./InputGroup.CGOI8iZn.js";import{u as F}from"./useKecamatan.BULQhWxi.js";import{u as le,a as te}from"./useSekolah.BeRg058J.js";import{j as ye}from"./jenjang.DlmV0PPG.js";import"./authComposable.sKl44bRY.js";import"./logo-ppdb.BW9ypDwz.js";import"./SpinnerLoading.vue_vue_type_script_setup_true_lang.CQvHfLuO.js";const he={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-4"},we={class:"w-full max-w-4xl rounded-lg bg-white shadow-xl max-h-[90vh] overflow-y-auto"},xe={class:"flex items-center justify-between border-b px-6 py-4"},Ve={class:"text-xl font-bold text-gray-900"},je={class:"grid grid-cols-1 gap-6 p-6 md:grid-cols-2"},Se={class:"flex flex-col gap-1"},_e=["disabled"],Pe=["value"],Me={class:"flex justify-end gap-3 border-t bg-gray-50 px-6 py-4"},$e=["disabled"],Ce={key:0,class:"mr-2 h-4 w-4 animate-spin rounded-full border-2 border-white border-t-transparent"},Ee=A({__name:"SekolahFormModal",props:{isOpen:{type:Boolean},isEditMode:{type:Boolean},schoolData:{},loading:{type:Boolean}},emits:["close","submit"],setup(b,{emit:d}){const h=b,k=d,{kecamatanList:x,fetchKecamatan:V}=F(),u=f([]),a=ue({nama_sekolah:"",nss:"",npsn:"",jenjang:"",alamat:"",no_telp:"",email:"",nama_kepsek:"",kecamatan_id:"",daya_tampung:"",username:"",password:""});C(()=>h.schoolData,t=>{var l,n,y;t&&(a.nama_sekolah=t.nama_sekolah||"",a.nss=t.nss||"",a.npsn=t.npsn||"",a.jenjang=t.jenjang||"",a.alamat=t.alamat||"",a.no_telp=t.no_telp||"",a.email=t.email||"",a.nama_kepsek=t.nama_kepsek||"",a.kecamatan_id=(t.kecamatan_id||((l=t.kecamatan)==null?void 0:l.id)||"").toString(),a.daya_tampung=((n=t.daya_tampung)==null?void 0:n.toString())||"",a.username=((y=t.user)==null?void 0:y.username)||"",a.password="")},{immediate:!0}),Z(async()=>{await V(),u.value=x.value});const w=()=>{k("submit",{...a})},v=()=>{k("close")};return(t,l)=>t.isOpen?(m(),p("div",he,[e("div",we,[e("div",xe,[e("h3",Ve,g(t.isEditMode?"Edit Data Sekolah":"Detail Sekolah"),1),e("button",{onClick:v,class:"text-gray-500 hover:text-gray-700"},l[12]||(l[12]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),e("form",{onSubmit:E(w,["prevent"])},[e("div",je,[r(c,{modelValue:a.nama_sekolah,"onUpdate:modelValue":l[0]||(l[0]=n=>a.nama_sekolah=n),label:"Nama Sekolah",name:"nama_sekolah",required:"",disabled:!t.isEditMode},null,8,["modelValue","disabled"]),r(c,{modelValue:a.nama_kepsek,"onUpdate:modelValue":l[1]||(l[1]=n=>a.nama_kepsek=n),label:"Kepala Sekolah",name:"nama_kepsek",required:"",disabled:!t.isEditMode},null,8,["modelValue","disabled"]),r(c,{modelValue:a.nss,"onUpdate:modelValue":l[2]||(l[2]=n=>a.nss=n),label:"NSS",name:"nss",inputmode:"numeric",disabled:!t.isEditMode},null,8,["modelValue","disabled"]),r(c,{modelValue:a.npsn,"onUpdate:modelValue":l[3]||(l[3]=n=>a.npsn=n),label:"NPSN",name:"npsn",inputmode:"numeric",disabled:!t.isEditMode},null,8,["modelValue","disabled"]),r(c,{modelValue:a.jenjang,"onUpdate:modelValue":l[4]||(l[4]=n=>a.jenjang=n),label:"Jenjang",name:"jenjang",required:"",disabled:!t.isEditMode},null,8,["modelValue","disabled"]),r(c,{modelValue:a.daya_tampung,"onUpdate:modelValue":l[5]||(l[5]=n=>a.daya_tampung=n),label:"Daya Tampung",name:"daya_tampung",inputmode:"numeric",disabled:!t.isEditMode},null,8,["modelValue","disabled"]),r(c,{modelValue:a.no_telp,"onUpdate:modelValue":l[6]||(l[6]=n=>a.no_telp=n),label:"No. Telepon",name:"no_telp",inputmode:"tel",disabled:!t.isEditMode},null,8,["modelValue","disabled"]),r(c,{modelValue:a.alamat,"onUpdate:modelValue":l[7]||(l[7]=n=>a.alamat=n),label:"Alamat",name:"alamat",required:"",disabled:!t.isEditMode},null,8,["modelValue","disabled"]),r(c,{modelValue:a.email,"onUpdate:modelValue":l[8]||(l[8]=n=>a.email=n),label:"Email Sekolah",name:"email",type:"email",required:"",disabled:!t.isEditMode},null,8,["modelValue","disabled"]),r(c,{modelValue:a.username,"onUpdate:modelValue":l[9]||(l[9]=n=>a.username=n),label:"Username Akun",name:"username",disabled:!t.isEditMode},null,8,["modelValue","disabled"]),r(c,{modelValue:a.password,"onUpdate:modelValue":l[10]||(l[10]=n=>a.password=n),label:"Password Akun (Isi jika ingin mengubah)",name:"password",type:"password",disabled:!t.isEditMode,placeholder:"Kosongkan jika tidak ingin mengubah"},null,8,["modelValue","disabled"]),e("div",Se,[l[14]||(l[14]=e("label",{class:"mb-1 block text-black"},"Kecamatan",-1)),ee(e("select",{"onUpdate:modelValue":l[11]||(l[11]=n=>a.kecamatan_id=n),class:"w-full rounded border-[1.5px] border-stroke bg-white px-5 py-3 text-black outline-none transition focus:border-primary active:border-primary disabled:bg-gray-100 disabled:cursor-not-allowed",disabled:!t.isEditMode},[l[13]||(l[13]=e("option",{value:"",disabled:""},"Pilih Kecamatan",-1)),(m(!0),p(D,null,U(u.value,n=>(m(),p("option",{key:n.id,value:n.id},g(n.nama),9,Pe))),128))],8,_e),[[me,a.kecamatan_id]])])]),e("div",Me,[e("button",{type:"button",onClick:v,class:"rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50"},g(t.isEditMode?"Batal":"Tutup"),1),t.isEditMode?(m(),p("button",{key:0,type:"submit",class:"inline-flex items-center rounded-lg bg-primary px-4 py-2 text-sm font-medium text-white hover:bg-opacity-90 disabled:opacity-50",disabled:t.loading},[t.loading?(m(),p("span",Ce)):_("",!0),l[15]||(l[15]=ae(" Simpan Perubahan "))],8,$e)):_("",!0)])],32)])])):_("",!0)}}),De={class:"flex flex-col h-full rounded-xl bg-white shadow-sm border border-gray-100 overflow-hidden"},Ue={class:"p-6 border-b border-gray-100"},Ne={class:"flex flex-wrap justify-between gap-4 items-center"},Te={class:"flex flex-wrap justify-end gap-2 items-center"},Ke={class:"relative w-full sm:w-64"},Be={class:"w-full sm:w-auto"},qe={class:"text-sm font-medium text-gray-500 bg-gray-50 px-3 py-1.5 rounded-lg border border-gray-100"},Ae={class:"flex-grow overflow-x-auto overflow-y-auto max-h-[calc(100vh-300px)] custom-scrollbar"},Fe={class:"table table-zebra table-pin-rows"},ze={key:1},Oe={colspan:"7",class:"text-center"},Le={class:"font-mono text-sm"},Ie={class:"flex gap-2"},Je=["href","onClick"],Ge=["href","onClick"],He={class:"rounded-b-lg border-t border-gray-200 px-4 py-2"},Re={class:"flex justify-end gap-1 text-xs font-medium"},Qe={key:0},We=["onClick"],Xe={key:1},Ye=A({__name:"MasterSekolahTable",props:{data:{type:Object,required:!1},loading:{type:Boolean,default:!1}},emits:["filter","page-change","prev-page","next-page","refresh"],setup(b,{emit:d}){const h=d,k=le(),{kecamatanList:x}=F(),{updateSekolah:V}=te(),u=f(""),a=f(""),w=f("20"),v=f("");let t=null;const l=f(!1),n=f("view"),y=f(null),N=f(!1),oe=pe(()=>{const i=ke(x.value,"nama","id");return[{value:null,label:"Semua Kecamatan"},...i]}),ne=f([{label:"Semua Jenjang",value:null},...ye]),se=f([{label:"10",value:10},{label:"20",value:20},{label:"50",value:50},{label:"100",value:100}]);C([u,a],()=>{h("filter",u.value,a.value,v.value)}),C(w,i=>{k.per_page=Number(i),h("filter",u.value,a.value,v.value)}),C(v,i=>{t&&clearTimeout(t),t=setTimeout(()=>{k.search=i,h("filter",u.value,a.value,i)},500)});const z=(i,o,M,$)=>{i.ctrlKey||i.metaKey||i.button===1||(i.preventDefault(),y.value=M,n.value=$,l.value=!0)},O=()=>{l.value=!1,y.value=null},de=async i=>{if(!y.value)return;N.value=!0;const o=await V(y.value.id,i);N.value=!1,o?(W({message:"Data sekolah berhasil diperbarui"}),O(),h("refresh")):W({message:"Gagal memperbarui data sekolah",type:"error"})};return(i,o)=>{var $,L,I,J,G,H;const M=be("router-link");return m(),p("div",De,[e("div",Ue,[e("div",Ne,[o[6]||(o[6]=e("h3",{class:"text-lg font-bold text-gray-800"},"Master Data Sekolah",-1)),e("div",Te,[e("div",Ke,[ee(e("input",{"onUpdate:modelValue":o[0]||(o[0]=s=>v.value=s),type:"text",placeholder:"Cari Sekolah...",class:"w-full rounded-lg border border-gray-200 bg-white py-2 pl-10 pr-4 text-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"},null,512),[[ge,v.value]]),r(S,{name:"view-finder",class:"absolute left-3 top-2.5 h-4 w-4 text-gray-400"})]),e("div",Be,[r(fe,{modelValue:w.value,"onUpdate:modelValue":o[1]||(o[1]=s=>w.value=s),name:"per_page",options:se.value,class:"w-full sm:w-auto"},null,8,["modelValue","options"])]),e("span",qe," Total: "+g(b.loading?"...":($=b.data)==null?void 0:$.total),1)])])]),e("div",Ae,[e("table",Fe,[e("thead",null,[e("tr",null,[o[8]||(o[8]=e("th",null,"No",-1)),o[9]||(o[9]=e("th",null,"Nama Sekolah",-1)),e("td",null,[r(Y,{modelValue:a.value,"onUpdate:modelValue":o[2]||(o[2]=s=>a.value=s),options:ne.value,class:"w-full",placeholder:"Jenjang",customClasses:"border-0 shadow-none"},null,8,["modelValue","options"])]),o[10]||(o[10]=e("td",null,"NSS",-1)),o[11]||(o[11]=e("td",null,"NPSN",-1)),o[12]||(o[12]=e("td",null,"Username",-1)),e("td",null,[o[7]||(o[7]=ae("Kecamatan ")),r(Y,{modelValue:u.value,"onUpdate:modelValue":o[3]||(o[3]=s=>u.value=s),options:oe.value,class:"w-full mt-1",placeholder:"Filter Kecamatan",customClasses:"border-0 shadow-none"},null,8,["modelValue","options"])]),o[13]||(o[13]=e("th",null,"Aksi",-1))])]),e("tbody",null,[b.loading?(m(),p(D,{key:0},U(5,s=>e("tr",{key:s},o[14]||(o[14]=[e("td",{colspan:"7"},[e("div",{class:"flex gap-4"},[e("span",{class:"skeleton h-4 w-8 rounded block"}),e("span",{class:"skeleton h-4 w-36 rounded block"}),e("span",{class:"skeleton h-4 w-24 rounded block"}),e("span",{class:"skeleton h-4 w-24 rounded block"}),e("span",{class:"skeleton h-4 w-24 rounded block"}),e("span",{class:"skeleton h-4 w-36 rounded block"}),e("span",{class:"skeleton h-4 w-12 rounded block"})])],-1)]))),64)):((L=b.data)==null?void 0:L.data.length)===0?(m(),p("tr",ze,[e("th",Oe,[r(ve,{title:"Data Sekolah",message:"Data Tidak Ditemukan"})])])):(m(!0),p(D,{key:2},U((I=b.data)==null?void 0:I.data,(s,j)=>{var R,Q;return m(),p("tr",{key:j},[e("td",null,g((P(k).currentPage-1)*P(k).per_page+j+1),1),e("th",null,g(s.nama_sekolah),1),e("td",null,[e("span",{class:X(["px-2 py-1 rounded text-xs font-semibold",{"bg-blue-100 text-blue-700":s.jenjang==="sd","bg-orange-100 text-orange-700":s.jenjang==="smp"}])},g(s.jenjang.toUpperCase()),3)]),e("td",null,g(s.nss||"-"),1),e("td",null,g(s.npsn||"-"),1),e("td",Le,g(((R=s.user)==null?void 0:R.username)||"-"),1),e("td",null,g(((Q=s.kecamatan)==null?void 0:Q.nama)||"-"),1),e("td",null,[e("div",Ie,[r(M,{to:{name:"sekolahDetail",params:{id:s.id},query:{mode:"view"}},custom:""},{default:q(({href:T,navigate:K})=>[e("a",{href:T,onClick:B=>z(B,K,s,"view"),class:"btn btn-sm btn-square btn-ghost text-blue-600 hover:bg-blue-50",title:"Lihat Detail"},[r(S,{name:"eye",class:"w-5 h-5"})],8,Je)]),_:2},1032,["to"]),r(M,{to:{name:"sekolahDetail",params:{id:s.id},query:{mode:"edit"}},custom:""},{default:q(({href:T,navigate:K})=>[e("a",{href:T,onClick:B=>z(B,K,s,"edit"),class:"btn btn-sm btn-square btn-ghost text-orange-600 hover:bg-orange-50",title:"Edit Data"},[r(S,{name:"document-text",class:"w-5 h-5"})],8,Ge)]),_:2},1032,["to"])])])])}),128))])])]),e("div",He,[e("ol",Re,[(J=b.data)!=null&&J.prevPage?(m(),p("li",Qe,[e("a",{onClick:o[4]||(o[4]=E(s=>i.$emit("prev-page"),["prevent"])),href:"#",class:"inline-flex size-8 items-center justify-center rounded border border-gray-100 bg-white text-gray-900 rtl:rotate-180 hover:bg-gray-50"},[o[15]||(o[15]=e("span",{class:"sr-only"},"Prev Page",-1)),r(S,{name:"chevron-left",class:"size-3"})])])):_("",!0),(m(!0),p(D,null,U(Array.from({length:((G=b.data)==null?void 0:G.lastPage)||1},(s,j)=>j+1),s=>(m(),p("li",{key:s},[e("a",{href:"#",class:X(["block size-8 rounded border text-center leading-8",P(k).currentPage===s?"bg-primary text-white border-primary":"text-gray-900 border-gray-100 bg-white hover:bg-gray-100"]),onClick:E(j=>i.$emit("page-change",s),["prevent"])},g(s),11,We)]))),128)),(H=b.data)!=null&&H.nextPage?(m(),p("li",Xe,[e("a",{onClick:o[5]||(o[5]=E(s=>i.$emit("next-page"),["prevent"])),href:"#",class:"inline-flex size-8 items-center justify-center rounded border border-gray-100 bg-white text-gray-900 rtl:rotate-180 hover:bg-gray-50"},[o[16]||(o[16]=e("span",{class:"sr-only"},"Next Page",-1)),r(S,{name:"chevron-right",class:"size-3"})])])):_("",!0)])]),r(Ee,{"is-open":l.value,"is-edit-mode":n.value==="edit","school-data":y.value,loading:N.value,onClose:O,onSubmit:de},null,8,["is-open","is-edit-mode","school-data","loading"])])}}}),ma=A({__name:"MasterSekolahView",setup(b){const d=le(),{fetchAllSekolah:h,loadingSekolah:k,dataSekolah:x}=te(),{fetchKecamatan:V}=F(),u=()=>{h(d.per_page,d.currentPage,d.jenjang,d.kecamatan_id,d.search)},a=l=>{d.page=l,d.currentPage=l,u()},w=()=>{d.page=d.page+1,d.currentPage=d.currentPage+1,u()},v=()=>{d.page=d.page-1,d.currentPage=d.currentPage-1,u()},t=(l,n,y)=>{d.kecamatan_id=l,d.jenjang=n,d.search=y,d.page=1,d.currentPage=1,u()};return Z(async()=>{await d.resetTodefault(),V(),u()}),(l,n)=>(m(),ce(ie,null,{default:q(()=>[r(re,{pageTitle:"Master Data Sekolah"}),r(Ye,{data:P(x),loading:P(k),onFilter:t,onRefresh:u,onPrevPage:v,onNextPage:w,onPageChange:a},null,8,["data","loading"])]),_:1}))}});export{ma as default};
