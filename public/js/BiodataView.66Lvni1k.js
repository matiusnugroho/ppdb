import{_ as de,a as ue}from"./DefaultLayout.vue_vue_type_script_setup_true_lang.DzSHU-wV.js";import{f as u,I as W,M as N,L as D,d as J,Q as G,A as me,g as R,o as P,c as U,a as e,u as o,i as j,b as l,C as z,n as O,e as E,p as C,v as pe,t as ce,B as x,m as be,w as fe}from"../index.js";import{u as I}from"./formValidationErrors.Bg25VS2r.js";import{C as _e}from"./component.DleZaA-r.js";import{u as ve}from"./useSmoothScrollToTop.BbHTvxvR.js";import{f as i}from"./fieldErrorHtml.CQlIIKHn.js";import{_ as F}from"./SpinnerLoading.vue_vue_type_script_setup_true_lang.CuUXFzUo.js";import{h as m}from"./hasError.BEgvbfcM.js";import{I as f}from"./InputGroup.B4554_nz.js";import{_ as ge}from"./SelectGroup.vue_vue_type_script_setup_true_lang.CJHeiv7S.js";import{_ as K}from"./PasswordInput.vue_vue_type_script_setup_true_lang.DTq_JsKd.js";import{u as ke}from"./useAkun.JoZZsxsW.js";import"./authComposable.-2CSDGmy.js";import"./logo-ppdb.BW9ypDwz.js";function he(){const L=u(0),s=u(!1),k=u(!1),y=u(null),_=u(!1),T=D.UPDATE_PHOTO_SISWA,r=D.ME_SISWA,p=W(),c=I();return{uploadPhoto:async w=>{var V,b;L.value=0,y.value=null,_.value=!1;const h=new FormData;h.append("foto",w);try{s.value=!0;const n=await N.post(T,h,{onUploadProgress:v=>{v.total&&(L.value=Math.round(v.loaded*100/v.total))}});if(n.data.success){const v=n.data.data;return p.biodata&&(p.biodata.thumbnail_url=v.thumbnail_url,p.biodata.foto_url=v.foto_url),_.value=!0,!0}else return c.errors=n.data.errors,!1}catch(n){return y.value=((b=(V=n.response)==null?void 0:V.data)==null?void 0:b.message)||"An error occurred during upload.",c.errors=n.response.data.errors,!1}finally{s.value=!1}},loadingUpdatePhoto:s,uploadProgress:L,uploadError:y,uploadSuccess:_,updateProfile:async w=>{var h,V;y.value=null,k.value=!0;try{const b=await N.patch(r,w);if(b.data.success){const n=b.data.data;return p.biodata&&(p.biodata=n.biodata,p.user=n.user),!0}else return c.errors=b.data.errors,!1}catch(b){return c.errors=((V=(h=b.response)==null?void 0:h.data)==null?void 0:V.errors)||{},!1}finally{k.value=!1}},loadingUpdateProfile:k}}const xe={class:"grid grid-cols-5 gap-8"},ye={class:"col-span-5 xl:col-span-3"},we={class:"rounded-sm border border-stroke bg-white shadow-default dark:border-strokedark dark:bg-boxdark"},Ve={key:0,class:"p-7"},Te={class:"mb-3"},Pe=["innerHTML"],Le={class:"mb-3"},Me=["innerHTML"],He={class:"mb-3"},Se=["innerHTML"],Ue={class:"mb-3"},je=["innerHTML"],Ce={class:"mb-3"},Ee=["innerHTML"],Fe={class:"mb-3"},Ne=["innerHTML"],De={class:"mb-3"},Ie=["innerHTML"],qe={class:"grid grid-cols-1 md:grid-cols-5 gap-6 mb-3"},Be={class:"md:col-span-3 flex flex-col"},Ae=["innerHTML"],$e={class:"md:col-span-2 flex flex-col"},Ge={class:"relative flex-grow"},ze={class:"absolute right-3 top-1/2 transform -translate-y-1/2 cursor-pointer text-primary"},Oe=["innerHTML"],Ke={class:"mb-3"},We=["innerHTML"],Je={class:"mb-3"},Re=["innerHTML"],Qe={class:"mb-3"},Ye=["innerHTML"],Xe={class:"flex justify-end gap-4.5"},Ze=["disabled"],ea={class:"flex items-center gap-2"},aa={key:0,class:"col-span-5 xl:col-span-2"},oa={class:"rounded-sm border border-stroke bg-white shadow-default dark:border-strokedark dark:bg-boxdark"},ta={class:"p-7"},ra={class:"flex flex-col items-center justify-center space-y-3"},sa={class:"text-primary flex h-10 w-10 items-center justify-center rounded-full bg-white dark:bg-meta-4"},la=["innerHTML"],na={key:0,class:"relative mt-4 flex items-center justify-center mb-3"},ia=["src"],da={key:0,class:"absolute inset-0 flex items-center justify-center bg-black bg-opacity-50 rounded"},ua={class:"flex justify-end gap-4.5"},ma=["disabled"],pa={class:"flex items-center gap-2"},ca={class:"mt-5 rounded-sm border border-stroke bg-white shadow-default dark:border-strokedark dark:bg-boxdark"},ba={class:"p-7"},fa={class:"mb-3"},_a=["innerHTML"],va={class:"mb-3"},ga=["innerHTML"],ka={class:"flex justify-end gap-4.5 m-2"},ha=["disabled"],xa={class:"flex items-center gap-2"},ya=J({__name:"FormBiodata",setup(L){const s=W(),{smoothScrollToTop:k}=ve(),y=I(),_=u(""),T=u("");let r=G({user:s.user?{...s.user}:null,biodata:s.biodata?{...s.biodata}:null});const p=u(""),c=u(null),M=u(!1),{uploadPhoto:q,loadingUpdatePhoto:w,uploadProgress:h,updateProfile:V,uploadError:b,loadingUpdateProfile:n}=he(),{loadingGantiPassword:v,gantiPassword:Q}=ke(),Y=me(()=>[{label:"Laki-laki",value:"L"},{label:"Perempuan",value:"P"}]),X=async()=>{var S,$;y.clearErrors();const{foto:d,...a}=r.biodata,t={...a,username:(S=r.user)==null?void 0:S.username,email:($=r.user)==null?void 0:$.email};n.value=!0,await V(t).catch(ie=>{x({message:"Profile update failed "+ie.message,type:"error"})}).finally(()=>{n.value=!1})?x({message:"Profile updated"}):x({message:"Profile update failed",type:"error"}),k("#sangkonten")},Z=()=>{r.user=s.user?{...s.user}:null,r.biodata=s.biodata?{...s.biodata}:null},ee=()=>{Z()},B=async()=>{await q(c.value)?x({message:"Foto berhasil diperbarui"}):x({message:"Gagal update foto, "+b.value,type:"error"}),M.value=!1,c.value=null,k("#sangkonten")},ae=d=>{var g;const a=d.target,t=(g=a.files)==null?void 0:g[0];t?A(t):p.value="kosong",a.value=""},oe=()=>{c.value=null,M.value=!1,r.biodata.thumbnail_url=s.biodata.thumbnail_url},te=u({allowInput:!0,format:"d-m-Y"}),H=u(!1),re=()=>{H.value=!0},se=()=>{H.value=!1},le=d=>{var t,g;H.value=!1;const a=(g=(t=d.dataTransfer)==null?void 0:t.files)==null?void 0:g[0];a&&A(a)},A=d=>{if(!d.type.startsWith("image/")){x({message:"File harus berupa gambar",type:"error"});return}const a=new FileReader;a.onload=t=>{var g,S;p.value=(g=t.target)==null?void 0:g.result,r.biodata.thumbnail_url=(S=t.target)==null?void 0:S.result},a.readAsDataURL(d),c.value=d,M.value=!0},ne=async()=>{const d={password_lama:_.value,password_baru:T.value},a=await Q(d);a.success?(x({message:"Password berhasil diganti"}),_.value="",T.value=""):x({message:"Password gagal diganti "+a.message,type:"error"})};return R(async()=>{s.biodata||await N.get(D.ME_SISWA).then(d=>{const a=d.data.data;s.biodata=a.biodata,s.user=a.user,r=G({user:s.user?{...s.user}:null,biodata:s.biodata?{...s.biodata}:null})})}),(d,a)=>(P(),U("div",xe,[e("div",ye,[e("div",we,[a[16]||(a[16]=e("div",{class:"border-b border-stroke py-4 px-7 dark:border-strokedark"},[e("h3",{class:"font-medium text-black dark:text-white"},"Personal Information")],-1)),o(r).biodata?(P(),U("div",Ve,[e("form",{onSubmit:j(X,["prevent"])},[e("div",Te,[l(f,{label:"Nomor Induk Siswa Nasional",modelValue:o(r).biodata.nisn,"onUpdate:modelValue":a[0]||(a[0]=t=>o(r).biodata.nisn=t),error:o(m)("nisn"),name:"nisn",inputmode:"numeric",required:""},null,8,["modelValue","error"]),e("div",{innerHTML:o(i)("nisn")},null,8,Pe)]),e("div",Le,[l(f,{label:"Nomor Induk Kependudukan",modelValue:o(r).biodata.nik,"onUpdate:modelValue":a[1]||(a[1]=t=>o(r).biodata.nik=t),error:o(m)("nik"),name:"nik",inputmode:"numeric",required:""},null,8,["modelValue","error"]),e("div",{innerHTML:o(i)("nik")},null,8,Me)]),e("div",He,[l(f,{label:"Nomor Kartu Keluarga",modelValue:o(r).biodata.no_kk,"onUpdate:modelValue":a[2]||(a[2]=t=>o(r).biodata.no_kk=t),error:o(m)("no_kk"),name:"no_kk",inputmode:"numeric",required:""},null,8,["modelValue","error"]),e("div",{innerHTML:o(i)("no_kk")},null,8,Se)]),e("div",Ue,[l(f,{label:"Nama",modelValue:o(r).biodata.nama,"onUpdate:modelValue":a[3]||(a[3]=t=>o(r).biodata.nama=t),error:o(m)("nama"),name:"nama",inputmode:"text",required:""},null,8,["modelValue","error"]),e("div",{innerHTML:o(i)("nama")},null,8,je)]),e("div",Ce,[l(ge,{modelValue:o(r).biodata.jenis_kelamin,"onUpdate:modelValue":a[4]||(a[4]=t=>o(r).biodata.jenis_kelamin=t),error:o(m)("jenis_kelamin"),name:"jenis_kelamin",label:"Jenis Kelamin",options:Y.value},null,8,["modelValue","error","options"]),e("div",{innerHTML:o(i)("jenis_kelamin")},null,8,Ee)]),e("div",Fe,[l(f,{label:"Email",modelValue:o(r).user.email,"onUpdate:modelValue":a[5]||(a[5]=t=>o(r).user.email=t),error:o(m)("email"),name:"email",type:"email",inputmode:"email",required:""},null,8,["modelValue","error"]),e("div",{innerHTML:o(i)("email")},null,8,Ne)]),e("div",De,[l(f,{label:"Username",modelValue:o(r).user.username,"onUpdate:modelValue":a[6]||(a[6]=t=>o(r).user.username=t),error:o(m)("username"),name:"username",inputmode:"text",required:""},null,8,["modelValue","error"]),e("div",{innerHTML:o(i)("username")},null,8,Ie)]),e("div",qe,[e("div",Be,[l(f,{class:"h-full",label:"Tempat Lahir",modelValue:o(r).biodata.tempat_lahir,"onUpdate:modelValue":a[7]||(a[7]=t=>o(r).biodata.tempat_lahir=t),error:o(m)("tempat_lahir"),name:"tempat_lahir",inputmode:"text",required:""},null,8,["modelValue","error"]),e("div",{innerHTML:o(i)("tempat_lahir")},null,8,Ae)]),e("div",$e,[a[14]||(a[14]=e("label",{class:"mb-1 block text-black dark:text-white",for:"tanggal-lahir"}," Tanggal Lahir ",-1)),e("div",Ge,[l(o(_e),{modelValue:o(r).biodata.tanggal_lahir,"onUpdate:modelValue":a[8]||(a[8]=t=>o(r).biodata.tanggal_lahir=t),class:"w-full rounded border border-stroke bg-gray py-1 px-2.5 font-normal text-black focus:border-primary focus-visible:outline-none dark:border-strokedark dark:bg-meta-4 dark:text-white dark:focus:border-primary h-full",config:te.value,id:"tanggal-lahir"},null,8,["modelValue","config"]),e("span",ze,[l(z,{name:"calendar-search",class:"w-5 h-5"})])]),e("div",{innerHTML:o(i)("tanggal_lahir")},null,8,Oe)])]),e("div",Ke,[l(f,{label:"Nama Ayah",modelValue:o(r).biodata.nama_bapak,"onUpdate:modelValue":a[9]||(a[9]=t=>o(r).biodata.nama_bapak=t),error:o(m)("nama_bapak"),name:"nama_bapak",inputmode:"text",required:""},null,8,["modelValue","error"]),e("div",{innerHTML:o(i)("nama_bapak")},null,8,We)]),e("div",Je,[l(f,{label:"Nama Ibu",modelValue:o(r).biodata.nama_ibu,"onUpdate:modelValue":a[10]||(a[10]=t=>o(r).biodata.nama_ibu=t),error:o(m)("nama_ibu"),name:"nama_ibu",inputmode:"text",required:""},null,8,["modelValue","error"]),e("div",{innerHTML:o(i)("nama_ibu")},null,8,Re)]),e("div",Qe,[l(f,{label:"No. HP Orang Tua",modelValue:o(r).biodata.no_hp_ortu,"onUpdate:modelValue":a[11]||(a[11]=t=>o(r).biodata.no_hp_ortu=t),error:o(m)("no_hp_ortu"),name:"no_hp_ortu",inputmode:"text",required:""},null,8,["modelValue","error"]),e("div",{innerHTML:o(i)("no_hp_ortu")},null,8,Ye)]),e("div",Xe,[e("button",{class:"flex justify-center rounded border border-stroke py-2 px-6 font-medium text-black hover:shadow-1 dark:border-strokedark dark:text-white",type:"button",onClick:ee}," Batal "),e("button",{class:"flex justify-center rounded bg-primary py-2 px-6 font-medium text-white hover:bg-opacity-90",type:"submit",disabled:o(n)},[e("span",ea,[l(F,{loading:o(n),size:"xs",class:O(["transition-transform duration-300 ease-in-out",o(n)?"translate-x-[-10px]":"translate-x-0"])},null,8,["loading","class"]),a[15]||(a[15]=E(" Simpan "))])],8,Ze)])],32)])):C("",!0)])]),o(r).biodata?(P(),U("div",aa,[e("div",oa,[a[21]||(a[21]=e("div",{class:"border-b border-stroke py-4 px-7 dark:border-strokedark"},[e("h3",{class:"font-medium text-black dark:text-white"},"Perbarui Foto")],-1)),e("div",ta,[e("form",{onSubmit:j(B,["prevent"])},[e("div",{id:"FileUpload",class:O([{"border-green-500":H.value,"border-primary":!H.value},"relative mb-3 block w-full cursor-pointer appearance-none rounded border-2 border-dashed bg-gray py-4 px-4 dark:bg-meta-4 sm:py-7.5"]),onDragover:j(re,["prevent"]),onDragleave:j(se,["prevent"]),onDrop:j(le,["prevent"])},[e("input",{type:"file",accept:"image/*",class:"absolute inset-0 z-50 m-0 h-full w-full cursor-pointer p-0 opacity-0 outline-none",onChange:ae},null,32),e("div",ra,[e("span",sa,[l(z,{name:"add-photo"})]),a[17]||(a[17]=e("p",{class:"text-sm font-medium items-center justify-center"},[e("span",{class:"text-primary"},"Click untuk memilih foto")],-1)),a[18]||(a[18]=e("p",{class:"text-sm font-medium items-center justify-center"},"atau seret foto ke kotak ini",-1)),a[19]||(a[19]=e("p",{class:"mt-1.5 text-sm font-medium"},"JPG atau JPEG",-1))])],34),e("div",{class:"mb-3",innerHTML:o(i)("foto")},null,8,la),M.value?(P(),U("div",na,[e("img",{src:p.value,alt:"Image Preview",class:"max-w-full h-auto rounded"},null,8,ia),o(w)?(P(),U("div",da,[e("div",{class:"radial-progress text-primary",style:pe({"--value":o(h)}),role:"progressbar"},ce(o(h))+"%",5)])):C("",!0)])):C("",!0),e("div",ua,[e("button",{class:"flex justify-center rounded border border-stroke py-2 px-6 font-medium text-black hover:shadow-1 dark:border-strokedark dark:text-white",type:"button",onClick:oe}," Cancel "),e("button",{class:"flex justify-center rounded bg-primary py-2 px-6 font-medium text-white hover:bg-opacity-90",onClick:B,type:"button",disabled:o(w)||!c.value},[e("span",pa,[l(F,{loading:o(w),size:"xs"},null,8,["loading"]),a[20]||(a[20]=E(" Simpan Foto "))])],8,ma)])],32)])]),e("div",ca,[a[23]||(a[23]=e("div",{class:"border-b border-stroke py-4 px-7 dark:border-strokedark"},[e("h3",{class:"font-medium text-black dark:text-white"},"Perbarui Password")],-1)),e("div",ba,[e("div",fa,[l(K,{label:"Password Lama",modelValue:_.value,"onUpdate:modelValue":a[12]||(a[12]=t=>_.value=t)},null,8,["modelValue"]),e("div",{innerHTML:o(i)("password_lama")},null,8,_a)]),e("div",va,[l(K,{label:"Password Baru",modelValue:T.value,"onUpdate:modelValue":a[13]||(a[13]=t=>T.value=t)},null,8,["modelValue"]),e("div",{innerHTML:o(i)("password_baru")},null,8,ga)]),e("div",ka,[e("button",{class:"flex justify-center rounded bg-primary py-2 px-6 font-medium text-white hover:bg-opacity-90",onClick:ne,type:"button",disabled:o(v)},[e("span",xa,[l(F,{loading:o(v),size:"xs"},null,8,["loading"]),a[22]||(a[22]=E(" Ganti Password "))])],8,ha)])])])])):C("",!0)]))}}),wa={class:"mx-auto max-w-270"},Ia=J({__name:"BiodataView",setup(L){const s=u("Biodata"),k=I();return R(()=>{k.clearErrors()}),(y,_)=>(P(),be(ue,null,{default:fe(()=>[e("div",wa,[l(de,{pageTitle:s.value},null,8,["pageTitle"]),l(ya)])]),_:1}))}});export{Ia as default};
