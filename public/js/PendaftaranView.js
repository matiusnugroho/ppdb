import{_ as X}from"./BreadcrumbDefault.vue_vue_type_script_setup_true_lang.js";import{_ as Z}from"./DefaultLayout.vue_vue_type_script_setup_true_lang.js";import{u as j}from"./formValidationErrors.js";import{g as u,l as N,E as B,G as Q,f as M,o as r,c as m,a as e,e as z,t as w,i as V,F as E,h as F,n as H,H as q,z as W,I as G,j as R,d as S,p as c,k as I,q as ee,B as te,b as se,u as ae,w as le,J as oe}from"../index.js";import{u as ne}from"./useKecamatan.js";import{b as re,A as ie}from"./AlertSuccess.js";import{f as A}from"./fieldErrorHtml.js";import{s as C}from"./toast.js";import{_ as L}from"./HeroIcon.vue_vue_type_script_setup_true_lang.js";import{s as J,_ as de}from"./ConfirmationComponent.vue_vue_type_script_setup_true_lang.js";import{_ as ue}from"./_plugin-vue_export-helper.js";import{u as ce,g as me}from"./getDataById.js";import"./authComposable.js";import"./SpinnerLoading.vue_vue_type_script_setup_true_lang.js";function fe(){const s=u(null),o=u(null),a=u(!1);return{registrationData:s,error:o,loadingRegistration:a,fetchRegistration:async()=>{a.value=!0;try{const i=await N.get(B.CEK_PENDAFTARAN);return s.value=i.data.registration,i.data}catch{o.value="Failed to load Registration list"}finally{a.value=!1}}}}function pe(){const s=u([]),o=u(null),a=u(!1);return{sekolahList:s,error:o,loadingSekolah:a,fetchSekolah:async(i,p="")=>{const l=Q(B.GET_SEKOLAH,{kecamatan_id:i,jenjang:p});a.value=!0;try{const n=await N.get(l);s.value=n.data.data}catch{o.value="Failed to load sekolah list"}finally{a.value=!1}}}}function Y(s,o,a){return s.map(f=>({label:f[o],value:f[a]}))}const he={class:"mb-2.5 block text-black dark:text-white"},_e={key:0,class:"text-meta-1"},ke=["model-value"],ve={value:""},xe=["value"],O=M({__name:"SelectGroup",props:{label:String,options:{type:Array,required:!0},customClasses:String,required:{type:Boolean,default:!1},modelValue:{type:String,default:""},placeholder:{type:String,default:"Pilih"}},emits:["update:modelValue"],setup(s,{emit:o}){const a=s,f=o,i=p=>{const l=p.target;f("update:modelValue",l.value)};return(p,l)=>(r(),m("div",{class:H(s.customClasses)},[e("label",he,[z(w(a.label)+" ",1),s.required?(r(),m("span",_e,"*")):V("",!0)]),e("select",{"model-value":s.modelValue,onChange:i,class:"w-full rounded border-[1.5px] text-black border-stroke bg-transparent py-2 px-2 font-normal outline-none transition focus:border-primary active:border-primary dark:text-white dark:border-form-strokedark dark:bg-form-input dark:focus:border-primary"},[e("option",ve,w(a.placeholder),1),(r(!0),m(E,null,F(s.options,n=>(r(),m("option",{key:n.value,value:n.value},w(n.label),9,xe))),128))],40,ke)],2))}});function be(){const s=u(!1),o=j(),a=u(null);return{registerSekolah:async i=>{var p,l,n,_;s.value=!0;try{const k=await N.post(B.DAFTAR_KE_SEKOLAH,i);return k.data.success?k:(o.errors=k.data.errors,a.value=k.data.message,!1)}catch(k){o.errors=((l=(p=k.response)==null?void 0:p.data)==null?void 0:l.errors)||{};const $=(_=(n=k.response)==null?void 0:n.data)==null?void 0:_.message;return a.value=$,!1}finally{s.value=!1}},loadingRegister:s,errorDaftar:a}}const ge={class:"max-w-md mx-auto mt-10 p-5 bg-white rounded-lg shadow-md"},ye={class:"mb-4"},we=["innerHTML"],$e={class:"mb-4"},De=["innerHTML"],Se={class:"mb-4"},Pe=["innerHTML"],Ve=["disabled"],Te={class:"flex items-center gap-2"},Ee=M({__name:"BelumDaftar",emits:["refreshParent"],setup(s,{emit:o}){const{fetchKecamatan:a,kecamatanList:f}=ne(),{fetchSekolah:i,sekolahList:p}=pe(),{loadingRegister:l,registerSekolah:n,errorDaftar:_}=be(),k=j(),$=o,y=u(""),v=u(""),h=u(""),t=u([{label:"SD",value:"sd"},{label:"SMP",value:"smp"}]),T=q(()=>Y(f.value,"nama","id")),D=q(()=>Y(p.value,"nama_sekolah","id")),d=W(),x=async()=>{if(k.clearErrors(),!y.value||!v.value||!h.value){y.value||k.addError("kecamatan_id","Pilih Kecamatan terlebih dahulu"),v.value||k.addError("sekolah_id","Pilih Sekolah terlebih dahulu"),h.value||k.addError("jenjang","Pilih Jenjang terlebih dahulu");return}const g={school_id:v.value,jenjang:h.value};await n(g)?(d.addMessage("success",{title:"Pendaftaran Berhasil",detail:"Silakan Lengkapi dokumen"}),$("refreshParent"),await te.go(0)):C({message:"Pendaftaran gagal, "+_.value,type:"error"})};return G(y,g=>{g&&i(g,h.value)}),G(h,g=>{g&&i(y.value,g)}),R(()=>{a()}),(g,b)=>(r(),m("div",ge,[b[4]||(b[4]=e("h1",{class:"text-xl font-bold mb-5 text-center"},"Pendaftaran",-1)),e("form",{onSubmit:ee(x,["prevent"])},[e("div",ye,[S(O,{label:"Pilih Kecamatan",placeholder:"Pilih Kecamatan",options:T.value,modelValue:y.value,"onUpdate:modelValue":b[0]||(b[0]=P=>y.value=P)},null,8,["options","modelValue"]),e("div",{innerHTML:c(A)("kecamatan_id")},null,8,we)]),e("div",$e,[S(O,{label:"Pilih Jenjang",placeholder:"Pilih Jenjang",options:t.value,modelValue:h.value,"onUpdate:modelValue":b[1]||(b[1]=P=>h.value=P)},null,8,["options","modelValue"]),e("div",{innerHTML:c(A)("jenjang")},null,8,De)]),e("div",Se,[S(O,{label:"Pilih Sekolah",placeholder:"Pilih Sekolah",options:D.value,modelValue:v.value,"onUpdate:modelValue":b[2]||(b[2]=P=>v.value=P)},null,8,["options","modelValue"]),e("div",{innerHTML:c(A)("sekolah_id")},null,8,Pe)]),e("button",{class:"flex justify-center rounded bg-primary py-2 px-6 font-medium text-white hover:bg-opacity-90",type:"submit",disabled:c(l)},[e("span",Te,[c(l)?(r(),I(c(re),{key:0,size:"4",color:"white",class:H(["transition-all duration-500 ease-out",{"opacity-0 -translate-x-5":!c(l),"opacity-100 translate-x-0":c(l)}])},null,8,["class"])):V("",!0),b[3]||(b[3]=z("Daftar "))])],8,Ve)],32)]))}});function Ce(){const s=u([]),o=u(null),a=u(!1);return{documentTypeList:s,error:o,loadingDocumentType:a,fetchDocumentType:async()=>{a.value=!0;try{const i=await N.get(B.GET_DOCUMENT_TYPE);s.value=i.data}catch{o.value="Failed to load Document Type list"}finally{a.value=!1}}}}const Le=M({__name:"InputFile",setup(s,{expose:o}){const a=u(null);return o({fileInput:a}),(f,i)=>(r(),m("input",{type:"file",ref_key:"fileInput",ref:a,class:"file-input file-input-bordered file-input-sm w-full max-w-xs"},null,512))}});function Me(){const s=u(!1),o=j();return{uploadDokumen:async f=>{var i,p;s.value=!0;try{const l=Q(B.UPLOAD_DOKUMEN,{id_dokumen:f.id_dokumen}),n=new FormData;n.append("file",f.file),n.append("id_dokumen",f.id_dokumen);const _=await N.post(l,n);return _.data.success?_.data:(o.errors=_.data.errors,!1)}catch(l){return o.errors=((p=(i=l.response)==null?void 0:i.data)==null?void 0:p.errors)||{file:[l.response.message]},l.response.data}finally{s.value=!1}},loadingUploadDokumen:s}}const je={key:0,class:"text-center mb-5"},Ne={class:"rounded-sm border border-stroke bg-white px-5 pt-6 pb-2.5 shadow-default dark:border-strokedark dark:bg-boxdark sm:px-7.5 xl:pb-1"},Be={class:"max-w-full overflow-x-auto"},Ue={class:"w-full table-auto"},Ae={class:"py-5 px-4"},Fe={class:"text-xl font-semibold text-black dark:text-white"},He={class:"py-5 px-4"},Ie={class:"text-xl font-semibold text-black dark:text-white"},Re={class:"py-5 px-4 text-center",colspan:"3"},Ke={class:"max-w-full overflow-x-auto"},Oe={class:"w-full table-auto"},ze={class:"py-5 px-4 pl-9 xl:pl-11"},qe={class:"font-medium text-black dark:text-white"},Ge={class:"text-center"},Je={class:"py-5 px-4"},Ye={class:"flex items-center space-x-3.5"},Qe={class:"tooltip","data-tip":"Lihat"},We=["href"],Xe={key:1,class:"cursor-not-allowed text-gray-400"},Ze={class:"tooltip","data-tip":"Upload"},et=["disabled","onClick"],tt={class:"modal-box"},st={class:"text-lg font-bold"},at={key:0,class:"loading loading-spinner loading-xs"},lt=["innerHTML"],ot=M({__name:"SudahDaftar",props:{registration:{type:Object,required:!0}},setup(s){const{fetchDocumentType:o,loadingDocumentType:a,documentTypeList:f}=Ce(),i=W(),p=u(null),l=u(null),n=u(),_=u(null),k=j();function $(D,d){return D.find(x=>x.id===d)}const{uploadDokumen:y,loadingUploadDokumen:v}=Me(),h=D=>{if(k.clearErrors(),l.value&&l.value.fileInput&&(l.value.fileInput.value=""),n.value=null,p.value){p.value.showModal(),n.value=D;let d=$(f.value,D);_.value=d.document_type.label}},t=async()=>{var g,b,P;const D=(P=(b=(g=l.value)==null?void 0:g.fileInput)==null?void 0:b.files)==null?void 0:P[0];if(!D){k.addError("file","File tidak boleh kosong"),C({message:"File tidak boleh kosong",type:"error"});return}const d={id_dokumen:n.value,file:D},x=await y(d);if(x.success){let U=$(f.value,n.value),K=x.data;U&&(U.status=K.status,U.path=K.path,U.url_path=K.url_path),T(),C({message:"Dokumen berhasil diupload",type:"success"})}else T(),C({message:"Dokumen gagal diupload, "+x.message,type:"error"})},T=()=>{l.value&&l.value.fileInput&&(l.value.fileInput.value=""),p.value&&p.value.close()};return R(async()=>{await o()}),(D,d)=>(r(),m(E,null,[c(a)?(r(),m("div",je,d[0]||(d[0]=[e("div",null,"Loading",-1)]))):V("",!0),c(i).messages.success?(r(),I(ie,{key:1,class:"mb-5",message:c(i).messages.success.title,detail:c(i).messages.success.detail},null,8,["message","detail"])):V("",!0),e("div",Ne,[e("div",Be,[e("table",Ue,[e("tr",null,[d[1]||(d[1]=e("td",{class:"py-5 px-4"},[e("h4",{class:"text-xl font-semibold text-black dark:text-white"},"Nama Sekolah")],-1)),d[2]||(d[2]=e("td",null,":",-1)),e("td",Ae,[e("h4",Fe,w(s.registration.school.nama_sekolah),1)])]),e("tr",null,[d[3]||(d[3]=e("td",{class:"py-5 px-4"},[e("h4",{class:"text-xl font-semibold text-black dark:text-white"},"Nomor Pendaftaran")],-1)),d[4]||(d[4]=e("td",null,":",-1)),e("td",He,[e("h4",Ie,w(s.registration.registration_number),1)])]),e("tr",null,[e("td",Re,[e("p",{class:H(["inline-flex rounded-full py-1 px-3 text-sm font-medium",c(J)[s.registration.status]])},w(s.registration.status),3)])])])]),e("div",Ke,[e("table",Oe,[d[5]||(d[5]=e("thead",null,[e("tr",{class:"bg-gray-2 text-left dark:bg-meta-4"},[e("th",{class:"min-w-[220px] py-4 px-4 font-medium text-black dark:text-white xl:pl-11"},"Dokumen"),e("th",{class:"min-w-[120px] py-4 px-4 font-medium text-black dark:text-white text-center"},"Status"),e("th",{class:"py-4 px-4 font-medium text-black dark:text-white"},"Actions")])],-1)),e("tbody",null,[(r(!0),m(E,null,F(c(f),(x,g)=>(r(),m("tr",{key:g},[e("td",ze,[e("h5",qe,w(x.document_type.label),1)]),e("td",Ge,[e("p",{class:H(["inline-flex rounded-full py-1 px-3 text-sm font-medium",c(J)[x.status]])},w(x.status),3)]),e("td",Je,[e("div",Ye,[e("div",Qe,[x.path?(r(),m("a",{key:0,href:x.url_path??"",class:"flex items-center hover:text-primary",target:"_blank",rel:"noopener noreferrer"},[S(L,{name:"view-finder",size:"18",class:"h-5 w-5"})],8,We)):(r(),m("span",Xe,[S(L,{name:"view-finder",size:"18",class:"h-5 w-5"})]))]),e("div",Ze,[e("button",{disabled:x.status==="diverifikasi",class:"flex items-center hover:text-primary",onClick:b=>h(x.id)},[S(L,{name:"upload",size:"18",class:"h-5 w-5"})],8,et)])])])]))),128))])])])]),e("dialog",{id:"upload-modal",class:"modal",ref_key:"uploadModal",ref:p},[e("div",tt,[d[7]||(d[7]=e("form",{method:"dialog"},[e("button",{class:"btn btn-sm btn-circle btn-ghost absolute right-2 top-2"},"✕")],-1)),e("h3",st,"Upload "+w(_.value),1),S(Le,{ref_key:"fileInput",ref:l},null,512),e("button",{class:"btn",onClick:t},[c(v)?(r(),m("span",at)):V("",!0),d[6]||(d[6]=z(" Upload"))]),e("div",{innerHTML:c(A)("file")},null,8,lt)])],512)],64))}}),nt={},rt={class:"rounded-sm border border-stroke bg-white px-5 pt-6 pb-2.5 shadow-default dark:border-strokedark dark:bg-boxdark sm:px-7.5 xl:pb-1"};function it(s,o){return r(),m("div",rt,o[0]||(o[0]=[se('<div class="hero bg-base-200 min-h-screen"><div class="hero-content text-center"><div class="max-w-md"><h1 class="text-5xl font-bold">Halo calon siswa</h1><p class="py-6">Saat ini PPDB belum mengadakan pendaftaran.</p></div></div></div>',1)]))}const dt=ue(nt,[["render",it]]),ut={class:"rounded-sm border border-stroke bg-white px-5 pt-6 pb-2.5 shadow-default dark:border-strokedark dark:bg-boxdark sm:px-7.5 xl:pb-1"},ct={class:"flex justify-between items-center mb-6"},mt={key:0,class:"text-black dark:text-white"},ft={class:"overflow-x-auto"},pt={class:"table"},ht={class:"flex items-center gap-3"},_t={class:"avatar"},kt={class:"mask mask-squircle h-12 w-12"},vt=["src","alt"],xt={class:"text-black dark:text-white font-medium font-semibold"},bt={class:"text-center"},gt={class:"flex flex-col items-center justify-center text-center align-middle py-5 px-4"},yt={key:0,class:"badge badge-warning"},wt={class:"py-5 px-4"},$t={class:"flex items-center space-x-3.5"},Dt={class:"tooltip","data-tip":"Lihat"},St=["href"],Pt={key:1,class:"flex items-center cursor-not-allowed text-gray-400"},Vt={class:"tooltip","data-tip":"Verifikasi"},Tt=["onClick","disabled"],Et=M({__name:"SekolahDaftar",setup(s){const{loadingPendaftar:o,dataPendaftar:a,fetchPendaftar:f,loadingVerifikasi:i,verifikasiPendaftaran:p,totalPendaftar:l}=ce(),n=u(null),_=u(""),k=v=>{var h;_.value="",(h=n.value)==null||h.show(),_.value=v},$=async()=>{var h;const v=await p(_.value);if(v.success){(h=n.value)==null||h.close();let t=me(a.value,_.value);t&&(t.status=v.data.status,t.verified_by=v.data.verified_by),C({type:"success",message:"Verifikasi pendaftaran berhasil"})}else C({type:"error",message:"Verifikasi pendaftaran gagal, "+v.message})},y=()=>{var v;_.value="",(v=n.value)==null||v.close()};return R(()=>{f()}),(v,h)=>(r(),m(E,null,[e("div",ut,[e("div",ct,[h[0]||(h[0]=e("h2",{class:"text-xl font-semibold text-black dark:text-white"},"Daftar Siswa Pendaftar",-1)),c(l)?(r(),m("p",mt,"Total "+w(c(l))+" Calon Siswa",1)):V("",!0)]),e("div",ft,[e("table",pt,[h[2]||(h[2]=e("thead",null,[e("tr",null,[e("th",{class:"text-left"},"Name"),e("th",{class:"text-center"},"NISN"),e("th",{class:"text-center"},"Status"),e("th")])],-1)),e("tbody",null,[c(o)?(r(),m(E,{key:0},F(2,t=>e("tr",{key:t},h[1]||(h[1]=[e("td",null,[e("div",{class:"flex items-center gap-3"},[e("div",{class:"avatar"},[e("div",{class:"skeleton rounded-full h-12 w-12"})]),e("div",null,[e("div",{class:"skeleton h-4 w-24 rounded"}),e("div",{class:"skeleton h-4 w-24 rounded mt-2"})])])],-1),e("td",null,[e("span",{class:"skeleton h-4 w-36 rounded block"})],-1),e("td",{class:"text-center"},[e("button",{class:"btn btn-ghost btn-xs"},"Status")],-1),e("td",null,null,-1)]))),64)):(r(!0),m(E,{key:1},F(c(a),(t,T)=>{var D,d,x,g,b;return r(),m("tr",{key:T},[e("td",null,[e("div",ht,[e("div",_t,[e("div",kt,[e("img",{src:(D=t==null?void 0:t.student)==null?void 0:D.thumbnail_url,alt:`Foto ${(d=t==null?void 0:t.student)==null?void 0:d.nama}`,class:"rounded-full h-12 w-12"},null,8,vt)])]),e("div",null,[e("div",xt,w((x=t==null?void 0:t.student)==null?void 0:x.nama),1),e("div",null,w(t.registration_number),1)])])]),e("td",bt,w((g=t==null?void 0:t.student)==null?void 0:g.nisn),1),e("td",gt,[e("div",null,w(t==null?void 0:t.status),1),(t==null?void 0:t.status)==="diverifikasi"?(r(),m("div",yt,w((b=t.verified_by)==null?void 0:b.username),1)):V("",!0)]),e("td",wt,[e("div",$t,[e("div",Dt,[t.id?(r(),m("a",{key:0,href:t.id??"",class:"flex items-center hover:text-primary",target:"_blank",rel:"noopener noreferrer"},[S(L,{name:"view-finder",size:"18",class:"h-5 w-5"})],8,St)):(r(),m("span",Pt,[S(L,{name:"view-finder",size:"18",class:"h-5 w-5"})]))]),e("div",Vt,[e("button",{class:"flex items-center hover:text-primary",onClick:P=>k(t.id),disabled:(t==null?void 0:t.status)==="diverifikasi"},[S(L,{name:"document-check",size:"18",class:"h-5 w-5"})],8,Tt)])])])])}),128))])])])]),S(de,{ref_key:"verifikasiModal",ref:n,title:"Verifikasi pendaftaran",message:"Apakah anda yakin ingin verifikasi pendafataran ini?",confirmLabel:"Verifikasi",cancelLabel:"Batal",loading:c(i),confirmHandler:$,cancelHandler:y},null,8,["loading"])],64))}}),Ct={class:"mx-auto"},Lt={key:0},Mt={key:1},Jt=M({__name:"PendaftaranView",setup(s){const o=u("Pendaftaran"),a=j(),{fetchRegistration:f,loadingRegistration:i,registrationData:p}=fe(),l=ae(),n=u(null),_=u(0);R(async()=>{a.clearErrors();const $=l.role;if($==="siswa")try{(await f()).success?n.value=p.value!==null?ot:Ee:n.value=dt}catch{}else($==="sekolah"||$==="verifikator_sekolah")&&(n.value=Et)});function k(){_.value++}return($,y)=>(r(),I(Z,null,{default:le(()=>[e("div",Ct,[S(X,{pageTitle:o.value},null,8,["pageTitle"]),c(i)?(r(),m("div",Lt,y[0]||(y[0]=[e("p",null,"Loading...",-1),e("svg",{class:"animate-spin h-5 w-5 text-blue-500",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",fill:"none",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 0116 0 8 8 0 11-16 0z"})],-1)]))):(r(),m("div",Mt,[(r(),I(oe(n.value),{registration:c(p),key:_.value,onRefreshParent:k},null,40,["registration"]))]))])]),_:1}))}});export{Jt as default};
