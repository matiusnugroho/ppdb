import{_ as Z}from"./BreadcrumbDefault.vue_vue_type_script_setup_true_lang.js";import{_ as ee}from"./DefaultLayout.vue_vue_type_script_setup_true_lang.js";import{u as N}from"./formValidationErrors.js";import{u as te}from"./useCekPendaftaran.js";import{d as C,o as s,c as a,e,g as A,t as y,p as E,F as j,n as H,q as K,i as h,A as F,E as R,j as q,D as X,k as J,h as O,f as P,u as i,b as I,l as se,J as ae,a as le,y as oe,w as ne,z as ie}from"../index.js";import{u as re,S as G,b as Y}from"./buatOption.js";import{a as de}from"./useSekolah.js";import{b as ue,A as ce}from"./AlertSuccess.js";import{f as U}from"./fieldErrorHtml.js";import{s as B}from"./toast.js";import{_ as M}from"./HeroIcon.vue_vue_type_script_setup_true_lang.js";import{s as Q,_ as me}from"./ConfirmationComponent.vue_vue_type_script_setup_true_lang.js";import{_ as pe}from"./_plugin-vue_export-helper.js";import{u as fe,g as he}from"./getDataById.js";import{_ as _e}from"./NoDataComponent.vue_vue_type_script_setup_true_lang.js";import"./authComposable.js";import"./logo-ppdb.js";import"./SpinnerLoading.vue_vue_type_script_setup_true_lang.js";const ke={class:"mb-2.5 block text-black dark:text-white"},ve={key:0,class:"text-meta-1"},be=["model-value"],xe={value:""},ge=["value"],ye=C({__name:"SelectGroup",props:{label:String,options:{type:Array,required:!0},customClasses:String,required:{type:Boolean,default:!1},modelValue:{type:String,default:""},placeholder:{type:String,default:"Pilih"},loading:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(l,{emit:u}){const d=l,x=u,k=c=>{const r=c.target;x("update:modelValue",r.value)};return(c,r)=>(s(),a("div",{class:K(l.customClasses)},[e("label",ke,[A(y(d.label)+" ",1),l.required?(s(),a("span",ve,"*")):E("",!0)]),e("select",{"model-value":l.modelValue,onChange:k,class:"w-full rounded border-[1.5px] text-black border-stroke bg-transparent py-2 px-2 font-normal outline-none transition focus:border-primary active:border-primary dark:text-white dark:border-form-strokedark dark:bg-form-input dark:focus:border-primary"},[e("option",xe,y(d.placeholder),1),(s(!0),a(j,null,H(l.options,o=>(s(),a("option",{key:o.value,value:o.value},y(o.label),9,ge))),128))],40,be)],2))}});function we(){const l=h(!1),u=N(),d=h(null);return{registerSekolah:async k=>{var c,r,o,m;l.value=!0;try{return await F.post(R.DAFTAR_KE_SEKOLAH,k)}catch(v){u.errors=((r=(c=v.response)==null?void 0:c.data)==null?void 0:r.errors)||{};const p=(m=(o=v.response)==null?void 0:o.data)==null?void 0:m.message;return d.value=p,v.response}finally{l.value=!1}},loadingRegister:l,errorDaftar:d}}const $e={class:"max-w-md mx-auto mt-10 p-5 bg-white rounded-lg shadow-md"},De={class:"mb-4"},Se=["innerHTML"],Pe={class:"mb-4"},Ve=["innerHTML"],Te={class:"mb-4"},Ee=["innerHTML"],Me=["disabled"],Ce={class:"flex items-center gap-2"},Le=C({__name:"BelumDaftar",emits:["refreshParent"],setup(l,{emit:u}){const{fetchKecamatan:d,kecamatanList:x,loadingKecamatan:k}=re(),{fetchSekolah:c,sekolahList:r,loadingSekolah:o}=de(),{loadingRegister:m,registerSekolah:v,errorDaftar:p}=we(),g=N(),S=u,f=h(""),w=h(""),t=h(""),L=h([{label:"Pilih Jenjang",value:null},{label:"SD",value:"sd"},{label:"SMP",value:"smp"}]),V=q(()=>Y(x.value,"nama","id")),n=q(()=>Y(r.value,"nama_sekolah","id")),D=X(),_=async()=>{if(g.clearErrors(),!f.value||!w.value||!t.value){f.value||g.addError("kecamatan_id","Pilih Kecamatan terlebih dahulu"),w.value||g.addError("sekolah_id","Pilih Sekolah terlebih dahulu"),t.value||g.addError("jenjang","Pilih Jenjang terlebih dahulu");return}const $={school_id:w.value,jenjang:t.value},b=await v($);b.data.success?(D.addMessage("success",{title:"Pendaftaran Berhasil",detail:"Silakan Lengkapi dokumen"}),S("refreshParent",b.data.data)):B({message:"Pendaftaran gagal, "+p.value,type:"error"})};return J(f,$=>{$&&c($,t.value)}),J(t,$=>{$&&(w.value="",c(f.value,$))}),O(()=>{d()}),($,b)=>(s(),a("div",$e,[b[4]||(b[4]=e("h1",{class:"text-xl font-bold mb-5 text-center"},"Pendaftaran",-1)),e("form",{onSubmit:se(_,["prevent"])},[e("div",De,[P(G,{required:"",label:"Pilih Kecamatan",placeholder:"Pilih Kecmatan",options:V.value,modelValue:f.value,"onUpdate:modelValue":b[0]||(b[0]=T=>f.value=T),loading:i(k)},null,8,["options","modelValue","loading"]),e("div",{innerHTML:i(U)("kecamatan_id")},null,8,Se)]),e("div",Pe,[P(ye,{label:"Pilih Jenjang",placeholder:"Pilih Jenjang",options:L.value,modelValue:t.value,"onUpdate:modelValue":b[1]||(b[1]=T=>t.value=T)},null,8,["options","modelValue"]),e("div",{innerHTML:i(U)("jenjang")},null,8,Ve)]),e("div",Te,[P(G,{label:"Pilih Sekolah",placeholder:"Pilih Sekolah",options:n.value,modelValue:w.value,"onUpdate:modelValue":b[2]||(b[2]=T=>w.value=T),loading:i(o)},null,8,["options","modelValue","loading"]),e("div",{innerHTML:i(U)("sekolah_id")},null,8,Ee)]),e("button",{class:"flex justify-center rounded bg-primary py-2 px-6 font-medium text-white hover:bg-opacity-90",type:"submit",disabled:i(m)},[e("span",Ce,[i(m)?(s(),I(i(ue),{key:0,size:"4",color:"white",class:K(["transition-all duration-500 ease-out",{"opacity-0 -translate-x-5":!i(m),"opacity-100 translate-x-0":i(m)}])},null,8,["class"])):E("",!0),b[3]||(b[3]=A("Daftar "))])],8,Me)],32)]))}});function je(){const l=h([]),u=h(null),d=h(!1);return{documentTypeList:l,error:u,loadingDocumentType:d,fetchDocumentType:async()=>{d.value=!0;try{const k=await F.get(R.GET_DOCUMENT_TYPE);l.value=k.data}catch{u.value="Failed to load Document Type list"}finally{d.value=!1}}}}const Be=C({__name:"InputFile",setup(l,{expose:u}){const d=h(null);return u({fileInput:d}),(x,k)=>(s(),a("input",{type:"file",ref_key:"fileInput",ref:d,class:"file-input file-input-bordered file-input-sm w-full max-w-xs"},null,512))}});function Ie(){const l=h(!1),u=N();return{uploadDokumen:async(x,k,c)=>{var o,m;l.value=!0;let r;try{switch(k){case"upload":r="UPLOAD_DOKUMEN";break;case"revisi":r="REVISI_DOKUMEN";break;default:r="REVISI_DOKUMEN"}const v=ae(R[r],{id_dokumen:x.id_dokumen}),p=new FormData;p.append("file",x.file),p.append("id_dokumen",x.id_dokumen),c&&p.append("alasan",c);const g=await F.post(v,p);return g.data.success?g.data:(u.errors=g.data.errors,!1)}catch(v){return u.errors=((m=(o=v.response)==null?void 0:o.data)==null?void 0:m.errors)||{file:[v.response.message]},v.response.data}finally{l.value=!1}},loadingUploadDokumen:l}}const Ne={key:0,class:"text-center mb-5"},Ue={class:"rounded-sm border border-stroke bg-white px-5 pt-6 pb-2.5 shadow-default dark:border-strokedark dark:bg-boxdark sm:px-7.5 xl:pb-1"},He={class:"max-w-full overflow-x-auto"},Ke={class:"w-full table-auto"},Oe={class:"py-5 px-4"},ze={class:"text-xl font-semibold text-black dark:text-white"},Ae={class:"py-5 px-4"},Fe={class:"text-xl font-semibold text-black dark:text-white"},Re={class:"py-5 px-4 text-center",colspan:"3"},qe={class:"max-w-full overflow-x-auto"},Je={class:"w-full table-auto"},Ge={class:"py-5 px-4 pl-9 xl:pl-11"},Ye={class:"font-medium text-black dark:text-white"},Qe={class:"text-center"},We={key:0,class:"text-black dark:text-white"},Xe={class:"py-5 px-4"},Ze={class:"flex items-center space-x-3.5"},et={class:"tooltip","data-tip":"Lihat"},tt=["href"],st={key:1,class:"cursor-not-allowed text-gray-400"},at=["data-tip"],lt=["disabled","onClick"],ot=["onClick"],nt={class:"modal-box"},it={class:"text-lg font-bold"},rt={key:0,class:"loading loading-spinner loading-xs"},dt=["innerHTML"],W=C({__name:"SudahDaftar",props:{registration:{type:Object,required:!0}},setup(l){const{fetchDocumentType:u,loadingDocumentType:d,documentTypeList:x}=je(),k=X(),c=h(null),r=h(null),o=h(),m=h(null),v=N(),p=h("upload");function g(V,n){return V.find(D=>D.id===n)}const{uploadDokumen:S,loadingUploadDokumen:f}=Ie(),w=(V,n="upload")=>{if(v.clearErrors(),p.value=n,r.value&&r.value.fileInput&&(r.value.fileInput.value=""),o.value=null,c.value){c.value.showModal(),o.value=V;let D=g(x.value,V);m.value=D.document_type.label}},t=async()=>{var _,$,b;const V=(b=($=(_=r.value)==null?void 0:_.fileInput)==null?void 0:$.files)==null?void 0:b[0];if(!V){v.addError("file","File tidak boleh kosong"),B({message:"File tidak boleh kosong",type:"error"});return}const n={id_dokumen:o.value,file:V},D=await S(n,p.value);if(D.success){let T=g(x.value,o.value),z=D.data;T&&(T.status=z.status,T.path=z.path,T.url_path=z.url_path),L(),B({message:"Dokumen berhasil diupload",type:"success"})}else L(),B({message:"Dokumen gagal diupload, "+D.message,type:"error"})},L=()=>{r.value&&r.value.fileInput&&(r.value.fileInput.value=""),c.value&&c.value.close()};return O(async()=>{await u()}),(V,n)=>{var D;return s(),a(j,null,[i(d)?(s(),a("div",Ne,n[0]||(n[0]=[e("div",null,"Loading",-1)]))):E("",!0),i(k).messages.success?(s(),I(ce,{key:1,class:"mb-5",message:i(k).messages.success.title,detail:i(k).messages.success.detail},null,8,["message","detail"])):E("",!0),e("div",Ue,[e("div",He,[e("table",Ke,[e("thead",null,[e("tr",null,[n[1]||(n[1]=e("td",{class:"py-5 px-4"},[e("h4",{class:"text-xl font-semibold text-black dark:text-white"},"Nama Sekolah")],-1)),n[2]||(n[2]=e("td",null,":",-1)),e("td",Oe,[e("h4",ze,y((D=l.registration.school)==null?void 0:D.nama_sekolah),1)])]),e("tr",null,[n[3]||(n[3]=e("td",{class:"py-5 px-4"},[e("h4",{class:"text-xl font-semibold text-black dark:text-white"},"Nomor Pendaftaran")],-1)),n[4]||(n[4]=e("td",null,":",-1)),e("td",Ae,[e("h4",Fe,y(l.registration.registration_number),1)])]),e("tr",null,[e("td",Re,[e("p",{class:K(["inline-flex rounded-full py-1 px-3 text-sm font-medium",i(Q)[l.registration.status]])},y(l.registration.status),3)])])])])]),e("div",qe,[e("table",Je,[n[5]||(n[5]=e("thead",null,[e("tr",{class:"bg-gray-2 text-left dark:bg-meta-4"},[e("th",{class:"min-w-[220px] py-4 px-4 font-medium text-black dark:text-white xl:pl-11"},"Dokumen"),e("th",{class:"min-w-[120px] py-4 px-4 font-medium text-black dark:text-white text-center"},"Status"),e("th",{class:"py-4 px-4 font-medium text-black dark:text-white"},"Actions")])],-1)),e("tbody",null,[(s(!0),a(j,null,H(i(x),(_,$)=>(s(),a("tr",{key:$},[e("td",Ge,[e("h5",Ye,y(_.document_type.label),1)]),e("td",Qe,[e("p",{class:K(["inline-flex rounded-full py-1 px-3 text-sm font-medium",i(Q)[_.status]])},y(_.status),3),_.status==="ditolak"?(s(),a("p",We,y(_.alasan),1)):E("",!0)]),e("td",Xe,[e("div",Ze,[e("div",et,[_.path?(s(),a("a",{key:0,href:_.url_path??"",class:"flex items-center hover:text-primary",target:"_blank",rel:"noopener noreferrer"},[P(M,{name:"view-finder",size:"18",class:"h-5 w-5"})],8,tt)):(s(),a("span",st,[P(M,{name:"view-finder",size:"18",class:"h-5 w-5"})]))]),e("div",{class:"tooltip","data-tip":_.status!=="ditolak"?"Upload":"Revisi"},[_.status!=="ditolak"?(s(),a("button",{key:0,disabled:_.status==="diverifikasi",class:"flex items-center hover:text-primary",onClick:b=>w(_.id,"upload")},[P(M,{name:"upload",size:"18",class:"h-5 w-5"})],8,lt)):(s(),a("button",{key:1,class:"flex items-center hover:text-primary",onClick:b=>w(_.id,"revisi")},[P(M,{name:"upload-double",size:"18",class:"h-5 w-5"})],8,ot))],8,at)])])]))),128))])])])]),e("dialog",{id:"upload-modal",class:"modal",ref_key:"uploadModal",ref:c},[e("div",nt,[n[7]||(n[7]=e("form",{method:"dialog"},[e("button",{class:"btn btn-sm btn-circle btn-ghost absolute right-2 top-2"},"✕")],-1)),e("h3",it,y(p.value==="upload"?"Upload":"Revisi")+" "+y(m.value),1),P(Be,{ref_key:"fileInput",ref:r},null,512),e("button",{class:"btn btn-sm",onClick:t},[i(f)?(s(),a("span",rt)):E("",!0),n[6]||(n[6]=A(" Upload"))]),e("div",{innerHTML:i(U)("file")},null,8,dt)])],512)],64)}}}),ut={},ct={class:"rounded-sm border border-stroke bg-white px-5 pt-6 pb-2.5 shadow-default dark:border-strokedark dark:bg-boxdark sm:px-7.5 xl:pb-1"};function mt(l,u){return s(),a("div",ct,u[0]||(u[0]=[le('<div class="hero bg-base-200 min-h-screen"><div class="hero-content text-center"><div class="max-w-md"><h1 class="text-5xl font-bold">Halo calon siswa</h1><p class="py-6">Saat ini PPDB belum mengadakan pendaftaran.</p></div></div></div>',1)]))}const pt=pe(ut,[["render",mt]]),ft={class:"hero bg-white max-h-screen"},ht=C({__name:"NoPendaftar",setup(l){return(u,d)=>(s(),a("div",ft,[P(_e,{title:"Belum ada pendaftar",message:"Belum ada pendaftar"})]))}}),_t={key:1,class:"rounded-sm border border-stroke bg-white px-5 pt-6 pb-2.5 shadow-default dark:border-strokedark dark:bg-boxdark sm:px-7.5 xl:pb-1"},kt={class:"flex justify-between items-center mb-6"},vt={key:0,class:"text-black dark:text-white"},bt={class:"overflow-x-auto"},xt={class:"table"},gt={class:"flex items-center gap-3"},yt={class:"avatar"},wt={class:"mask mask-squircle h-12 w-12"},$t=["src","alt"],Dt={class:"text-black dark:text-white font-medium font-semibold"},St={class:"text-center"},Pt={class:"flex flex-col items-center justify-center text-center align-middle py-5 px-4"},Vt={key:0,class:"badge badge-warning"},Tt={class:"py-5 px-4"},Et={class:"flex items-center space-x-3.5"},Mt={class:"tooltip","data-tip":"Lihat"},Ct=["href"],Lt={key:1,class:"flex items-center cursor-not-allowed text-gray-400"},jt={class:"tooltip","data-tip":"Verifikasi"},Bt=["onClick","disabled"],It=C({__name:"SekolahDaftar",setup(l){const{loadingPendaftar:u,dataPendaftar:d,fetchPendaftar:x,loadingVerifikasi:k,verifikasiPendaftaran:c,totalPendaftar:r}=fe(),o=h(null),m=h(""),v=S=>{var f;m.value="",(f=o.value)==null||f.show(),m.value=S},p=async()=>{var f;const S=await c(m.value);if(S.success){(f=o.value)==null||f.close();let w=he(d.value,m.value);w&&(w.status=S.data.status,w.verified_by=S.data.verified_by),B({type:"success",message:"Verifikasi pendaftaran berhasil"})}else B({type:"error",message:"Verifikasi pendaftaran gagal, "+S.message})},g=()=>{var S;m.value="",(S=o.value)==null||S.close()};return O(()=>{x()}),(S,f)=>{var w;return s(),a(j,null,[((w=i(d))==null?void 0:w.length)===0?(s(),I(ht,{key:0})):(s(),a("div",_t,[e("div",kt,[f[0]||(f[0]=e("h2",{class:"text-xl font-semibold text-black dark:text-white"},"Daftar Siswa Pendaftar",-1)),i(r)?(s(),a("p",vt,"Total "+y(i(r))+" Calon Siswa",1)):E("",!0)]),e("div",bt,[e("table",xt,[f[2]||(f[2]=e("thead",null,[e("tr",null,[e("th",{class:"text-left"},"Name"),e("th",{class:"text-center"},"NISN"),e("th",{class:"text-center"},"Status"),e("th")])],-1)),e("tbody",null,[i(u)?(s(),a(j,{key:0},H(2,t=>e("tr",{key:t},f[1]||(f[1]=[e("td",null,[e("div",{class:"flex items-center gap-3"},[e("div",{class:"avatar"},[e("div",{class:"skeleton rounded-full h-12 w-12"})]),e("div",null,[e("div",{class:"skeleton h-4 w-24 rounded"}),e("div",{class:"skeleton h-4 w-24 rounded mt-2"})])])],-1),e("td",null,[e("span",{class:"skeleton h-4 w-36 rounded block"})],-1),e("td",{class:"text-center"},[e("button",{class:"btn btn-ghost btn-xs"},"Status")],-1),e("td",null,null,-1)]))),64)):(s(!0),a(j,{key:1},H(i(d),(t,L)=>{var V,n,D,_,$;return s(),a("tr",{key:L},[e("td",null,[e("div",gt,[e("div",yt,[e("div",wt,[e("img",{src:(V=t==null?void 0:t.student)==null?void 0:V.thumbnail_url,alt:`Foto ${(n=t==null?void 0:t.student)==null?void 0:n.nama}`,class:"rounded-full h-12 w-12"},null,8,$t)])]),e("div",null,[e("div",Dt,y((D=t==null?void 0:t.student)==null?void 0:D.nama),1),e("div",null,y(t.registration_number),1)])])]),e("td",St,y((_=t==null?void 0:t.student)==null?void 0:_.nisn),1),e("td",Pt,[e("div",null,y(t==null?void 0:t.status),1),(t==null?void 0:t.status)==="diverifikasi"?(s(),a("div",Vt,y(($=t.verified_by)==null?void 0:$.username),1)):E("",!0)]),e("td",Tt,[e("div",Et,[e("div",Mt,[t.id?(s(),a("a",{key:0,href:t.id??"",class:"flex items-center hover:text-primary",target:"_blank",rel:"noopener noreferrer"},[P(M,{name:"view-finder",size:"18",class:"h-5 w-5"})],8,Ct)):(s(),a("span",Lt,[P(M,{name:"view-finder",size:"18",class:"h-5 w-5"})]))]),e("div",jt,[e("button",{class:"flex items-center hover:text-primary",onClick:b=>v(t.id),disabled:(t==null?void 0:t.status)==="diverifikasi"},[P(M,{name:"document-check",size:"18",class:"h-5 w-5"})],8,Bt)])])])])}),128))])])])])),P(me,{ref_key:"verifikasiModal",ref:o,title:"Verifikasi pendaftaran",message:"Apakah anda yakin ingin verifikasi pendafataran ini?",confirmLabel:"Verifikasi",cancelLabel:"Batal",loading:i(k),confirmHandler:p,cancelHandler:g},null,8,["loading"])],64)}}}),Nt={class:"mx-auto"},Ut={key:0},Ht={key:1},ls=C({__name:"PendaftaranView",setup(l){const u=h("Pendaftaran"),d=N(),{fetchRegistration:x,loadingRegistration:k,registrationData:c}=te(),r=oe(),o=h(null),m=h(0);O(async()=>{d.clearErrors();const p=r.role;if(p==="siswa")try{(await x()).success?o.value=c.value!==null?W:Le:o.value=pt}catch{}else(p==="sekolah"||p==="verifikator_sekolah")&&(o.value=It)});function v(p){c.value=p,o.value=W}return(p,g)=>(s(),I(ee,null,{default:ne(()=>[e("div",Nt,[P(Z,{pageTitle:u.value},null,8,["pageTitle"]),i(k)?(s(),a("div",Ut,g[0]||(g[0]=[e("p",null,"Loading...",-1),e("svg",{class:"animate-spin h-5 w-5 text-blue-500",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",fill:"none",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 0116 0 8 8 0 11-16 0z"})],-1)]))):(s(),a("div",Ht,[(s(),I(ie(o.value),{registration:i(c),key:m.value,onRefreshParent:v},null,40,["registration"]))]))])]),_:1}))}});export{ls as default};
//# sourceMappingURL=PendaftaranView.js.map
