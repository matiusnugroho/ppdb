import{f as q,I as D,M as P,L as A,d as B,A as N,Q as R,k as C,g as F,o as v,m as O,w as G,a as e,b as m,c as w,t as n,e as T,u as d,i as J,p as $,R as Q,B as U}from"../index.js";import{_ as z,a as W}from"./DefaultLayout.vue_vue_type_script_setup_true_lang.DzSHU-wV.js";import{u as X}from"./useKecamatan.CAPM-1Cn.js";import{u as K}from"./formValidationErrors.Bg25VS2r.js";import{f as u}from"./fieldErrorHtml.CQlIIKHn.js";import{I as g}from"./InputGroup.B4554_nz.js";import"./authComposable.-2CSDGmy.js";import"./logo-ppdb.BW9ypDwz.js";function Y(){const x=q(!1),i=K(),c=D();return{loadingUpdateSekolah:x,updateSekolahProfile:async V=>{var _,b,f,k;i.clearErrors(),x.value=!0;try{const{data:o}=await P.patch(A.UPDATE_SEKOLAH_ME,V);if(o.success){const h=(_=o.data)==null?void 0:_.school;return c&&(c.biodata=h,c.user=((b=o.data)==null?void 0:b.user)??c.user),!0}return i.errors=o.errors||{},!1}catch(o){return i.errors=((k=(f=o==null?void 0:o.response)==null?void 0:f.data)==null?void 0:k.errors)||{},!1}finally{x.value=!1}}}}const Z={class:"mx-auto max-w-4xl space-y-6"},ee={key:0,class:"overflow-hidden rounded-lg border border-gray-200 bg-white shadow-sm"},ae={class:"border-b border-gray-200 bg-gray-50 px-6 py-4"},se={class:"text-2xl font-bold text-gray-900"},te={class:"text-sm text-gray-600"},oe={class:"grid grid-cols-1 gap-6 px-6 py-6 md:grid-cols-2"},re={class:"space-y-1 rounded-md border border-gray-100 bg-gray-50 px-4 py-3"},ne={class:"text-sm font-semibold text-gray-900"},le={class:"space-y-1 rounded-md border border-gray-100 bg-gray-50 px-4 py-3"},de={class:"text-sm font-semibold text-gray-900"},ie={class:"space-y-1 rounded-md border border-gray-100 bg-gray-50 px-4 py-3"},me={class:"text-sm font-semibold text-gray-900"},pe={class:"space-y-1 rounded-md border border-gray-100 bg-gray-50 px-4 py-3"},ue={class:"text-sm font-semibold text-gray-900"},ge={class:"space-y-1 rounded-md border border-gray-100 bg-gray-50 px-4 py-3"},ce={class:"text-sm font-semibold text-gray-900"},be={class:"space-y-1 rounded-md border border-gray-100 bg-gray-50 px-4 py-3"},ye={class:"text-sm font-semibold text-gray-900 break-words"},xe={class:"space-y-1 rounded-md border border-gray-100 bg-gray-50 px-4 py-3"},_e={class:"text-sm font-semibold text-gray-900"},fe={class:"space-y-1 rounded-md border border-gray-100 bg-gray-50 px-4 py-3"},ke={class:"text-sm font-semibold text-gray-900"},he={key:1,class:"rounded-lg border border-dashed border-gray-300 bg-white px-6 py-10 text-center text-gray-600"},ve={class:"overflow-hidden rounded-lg border border-gray-200 bg-white shadow-sm"},Se={class:"grid grid-cols-1 gap-6 px-6 py-6 md:grid-cols-2"},Ve={class:"space-y-1"},we={class:"text-sm font-semibold text-gray-900"},Te={class:"space-y-1"},je={class:"text-sm font-semibold text-gray-900 break-words"},Me={class:"space-y-1"},Le={class:"text-sm font-semibold text-gray-900"},He={class:"overflow-hidden rounded-lg border border-gray-200 bg-white shadow-sm"},Ee={class:"grid grid-cols-1 gap-6 md:grid-cols-2"},Ne={class:"flex flex-col gap-1"},Ue=["value"],De={class:"flex flex-wrap items-center justify-end gap-3"},Pe=["disabled"],Ae={key:0,class:"mr-2 h-4 w-4 animate-spin rounded-full border-2 border-white border-t-transparent"},Ke={class:"grid grid-cols-2 gap-3 text-sm text-red-600"},Ie=["innerHTML"],qe=["innerHTML"],Be=["innerHTML"],Re=["innerHTML"],Ce=["innerHTML"],Fe=["innerHTML"],Oe=["innerHTML"],Ge=["innerHTML"],Je=["innerHTML"],aa=B({__name:"ProfileSekolahView",setup(x){const i=D(),c=Q(),S=K(),{kecamatanList:V,fetchKecamatan:_}=X(),{loadingUpdateSekolah:b,updateSekolahProfile:f}=Y(),k=["sekolah","verifikator_sekolah"],o=N(()=>i.biodata??null),h=N(()=>i.user),s=R({nama_sekolah:"",nss:"",npsn:"",jenjang:"",alamat:"",no_telp:"",email:"",nama_kepsek:"",kecamatan_id:"",daya_tampung:""}),p=t=>{var a;return!!((a=S.errors[t])!=null&&a.length)},j=t=>{var a,y;t&&(s.nama_sekolah=t.nama_sekolah||"",s.nss=t.nss||"",s.npsn=t.npsn||"",s.jenjang=t.jenjang||"",s.alamat=t.alamat||"",s.no_telp=t.no_telp||"",s.email=t.email||"",s.nama_kepsek=t.nama_kepsek||"",s.kecamatan_id=(t.kecamatan_id||((a=t.kecamatan)==null?void 0:a.id)||"").toString(),s.daya_tampung=((y=t.daya_tampung)==null?void 0:y.toString())||"")},M=async()=>{try{const{data:t}=await P.get(A.ME_SEKOLAH);t.success&&(i.biodata=t.data,j(t.data))}catch{}},I=async()=>{const t={nama_sekolah:s.nama_sekolah,nss:s.nss,npsn:s.npsn,jenjang:s.jenjang,alamat:s.alamat,no_telp:s.no_telp,email:s.email,nama_kepsek:s.nama_kepsek,kecamatan_id:s.kecamatan_id};s.daya_tampung!==""&&(t.daya_tampung=Number(s.daya_tampung)),await f(t)?(U({message:"Data sekolah berhasil diperbarui"}),await M()):U({message:"Gagal memperbarui data sekolah",type:"error"})};C(()=>o.value,t=>{j(t)},{immediate:!0}),F(async()=>{if(!i.isLoggedIn()){c.replace({name:"login"});return}if(!k.includes(i.role??"")){c.replace({name:"ppdbDashboard"});return}S.clearErrors(),await _(),await M()});const l=t=>t==null||t===""?"-":t;return(t,a)=>(v(),O(W,null,{default:G(()=>{var y,L,H,E;return[e("div",Z,[m(z,{pageTitle:"Data Sekolah"}),o.value?(v(),w("div",ee,[e("div",ae,[a[10]||(a[10]=e("p",{class:"text-xs font-semibold uppercase text-gray-500"},"Data Sekolah",-1)),e("h2",se,n(o.value.nama_sekolah),1),e("p",te,[T(" Jenjang "+n(l(o.value.jenjang))+" ",1),a[9]||(a[9]=e("span",{class:"mx-2 text-gray-300"},"|",-1)),T(" NPSN "+n(l(o.value.npsn)),1)])]),e("div",oe,[e("div",re,[a[11]||(a[11]=e("p",{class:"text-xs font-semibold uppercase text-gray-500"},"Nama Sekolah",-1)),e("p",ne,n(l(o.value.nama_sekolah)),1)]),e("div",le,[a[12]||(a[12]=e("p",{class:"text-xs font-semibold uppercase text-gray-500"},"NSS",-1)),e("p",de,n(l(o.value.nss)),1)]),e("div",ie,[a[13]||(a[13]=e("p",{class:"text-xs font-semibold uppercase text-gray-500"},"Kecamatan",-1)),e("p",me,n(l((y=o.value.kecamatan)==null?void 0:y.nama)),1)]),e("div",pe,[a[14]||(a[14]=e("p",{class:"text-xs font-semibold uppercase text-gray-500"},"Alamat",-1)),e("p",ue,n(l(o.value.alamat)),1)]),e("div",ge,[a[15]||(a[15]=e("p",{class:"text-xs font-semibold uppercase text-gray-500"},"No. Telepon",-1)),e("p",ce,n(l(o.value.no_telp)),1)]),e("div",be,[a[16]||(a[16]=e("p",{class:"text-xs font-semibold uppercase text-gray-500"},"Email Sekolah",-1)),e("p",ye,n(l(o.value.email)),1)]),e("div",xe,[a[17]||(a[17]=e("p",{class:"text-xs font-semibold uppercase text-gray-500"},"Kepala Sekolah",-1)),e("p",_e,n(l(o.value.nama_kepsek)),1)]),e("div",fe,[a[18]||(a[18]=e("p",{class:"text-xs font-semibold uppercase text-gray-500"},"Daya Tampung",-1)),e("p",ke,n(l(o.value.daya_tampung)),1)])])])):(v(),w("div",he," Data sekolah tidak tersedia. Silakan login ulang untuk memuat data terbaru. ")),e("div",ve,[a[22]||(a[22]=e("div",{class:"border-b border-gray-200 bg-gray-50 px-6 py-4"},[e("p",{class:"text-xs font-semibold uppercase text-gray-500"},"Akun"),e("h2",{class:"text-lg font-bold text-gray-900"},"Informasi Akun")],-1)),e("div",Se,[e("div",Ve,[a[19]||(a[19]=e("p",{class:"text-xs font-semibold uppercase text-gray-500"},"Username",-1)),e("p",we,n(l((L=h.value)==null?void 0:L.username)),1)]),e("div",Te,[a[20]||(a[20]=e("p",{class:"text-xs font-semibold uppercase text-gray-500"},"Email",-1)),e("p",je,n(l((H=h.value)==null?void 0:H.email)),1)]),e("div",Me,[a[21]||(a[21]=e("p",{class:"text-xs font-semibold uppercase text-gray-500"},"Role",-1)),e("p",Le,n(l(d(i).role)),1)])])]),e("div",He,[a[26]||(a[26]=e("div",{class:"border-b border-gray-200 bg-gray-50 px-6 py-4"},[e("p",{class:"text-xs font-semibold uppercase text-gray-500"},"Perbarui Data"),e("h2",{class:"text-lg font-bold text-gray-900"},"Edit Data Sekolah")],-1)),e("form",{class:"space-y-6 px-6 py-6",onSubmit:J(I,["prevent"])},[e("div",Ee,[m(g,{modelValue:s.nama_sekolah,"onUpdate:modelValue":a[0]||(a[0]=r=>s.nama_sekolah=r),label:"Nama Sekolah",name:"nama_sekolah",required:"",error:p("nama_sekolah")},null,8,["modelValue","error"]),m(g,{modelValue:s.nama_kepsek,"onUpdate:modelValue":a[1]||(a[1]=r=>s.nama_kepsek=r),label:"Kepala Sekolah",name:"nama_kepsek",required:"",error:p("nama_kepsek")},null,8,["modelValue","error"]),m(g,{modelValue:s.nss,"onUpdate:modelValue":a[2]||(a[2]=r=>s.nss=r),label:"NSS",name:"nss",inputmode:"numeric",error:p("nss")},null,8,["modelValue","error"]),m(g,{modelValue:s.npsn,"onUpdate:modelValue":a[3]||(a[3]=r=>s.npsn=r),label:"NPSN",name:"npsn",inputmode:"numeric",error:p("npsn")},null,8,["modelValue","error"]),m(g,{modelValue:s.jenjang,"onUpdate:modelValue":a[4]||(a[4]=r=>s.jenjang=r),label:"Jenjang",name:"jenjang",required:"",error:p("jenjang")},null,8,["modelValue","error"]),m(g,{modelValue:s.daya_tampung,"onUpdate:modelValue":a[5]||(a[5]=r=>s.daya_tampung=r),label:"Daya Tampung",name:"daya_tampung",inputmode:"numeric",error:p("daya_tampung")},null,8,["modelValue","error"]),m(g,{modelValue:s.no_telp,"onUpdate:modelValue":a[6]||(a[6]=r=>s.no_telp=r),label:"No. Telepon",name:"no_telp",inputmode:"tel",error:p("no_telp")},null,8,["modelValue","error"]),m(g,{modelValue:s.email,"onUpdate:modelValue":a[7]||(a[7]=r=>s.email=r),label:"Email Sekolah",name:"email",type:"email",required:"",error:p("email")},null,8,["modelValue","error"]),m(g,{modelValue:s.alamat,"onUpdate:modelValue":a[8]||(a[8]=r=>s.alamat=r),label:"Alamat",name:"alamat",required:"",error:p("alamat")},null,8,["modelValue","error"]),e("div",Ne,[a[23]||(a[23]=e("label",{class:"mb-1 block text-black"},"Kecamatan",-1)),e("input",{disabled:"",value:((E=d(V).find(r=>String(r.id)===String(s.kecamatan_id)))==null?void 0:E.nama)||"-",class:"w-full rounded border-[1.5px] border-stroke bg-gray px-2 py-2 text-black outline-none disabled:cursor-not-allowed disabled:bg-gray-100"},null,8,Ue),a[24]||(a[24]=e("p",{class:"text-xs text-gray-500"},"Hubungi admin untuk mengubah kecamatan.",-1))])]),e("div",De,[e("button",{type:"submit",class:"inline-flex items-center rounded bg-primary px-5 py-2 text-sm font-semibold text-white transition hover:bg-opacity-90 disabled:cursor-not-allowed disabled:opacity-70",disabled:d(b)},[d(b)?(v(),w("span",Ae)):$("",!0),a[25]||(a[25]=T(" Simpan Perubahan "))],8,Pe)]),e("div",Ke,[e("div",{innerHTML:d(u)("nama_sekolah")},null,8,Ie),e("div",{innerHTML:d(u)("nama_kepsek")},null,8,qe),e("div",{innerHTML:d(u)("nss")},null,8,Be),e("div",{innerHTML:d(u)("npsn")},null,8,Re),e("div",{innerHTML:d(u)("jenjang")},null,8,Ce),e("div",{innerHTML:d(u)("daya_tampung")},null,8,Fe),e("div",{innerHTML:d(u)("no_telp")},null,8,Oe),e("div",{innerHTML:d(u)("email")},null,8,Ge),e("div",{innerHTML:d(u)("alamat")},null,8,Je)])],32)])])]}),_:1}))}});export{aa as default};
